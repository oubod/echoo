<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardioVision Pro - Advanced Echocardiography Report System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        :root {
            --primary-color: #1e40af;
            --primary-light: #3b82f6;
            --primary-dark: #1e3a8a;
            --secondary-color: #f8fafc;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --border-color: #e5e7eb;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-light: #9ca3af;
            --border-color: #374151;
            --secondary-color: #1f2937;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            background: var(--bg-primary);
            box-shadow: var(--shadow-xl);
        }

        /* Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 2rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .app-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* Form Panel */
        .form-panel {
            width: 45%;
            background: var(--bg-primary);
            overflow-y: auto;
            max-height: calc(100vh - 70px);
            margin-top: 70px;
            border-right: 1px solid var(--border-color);
        }

        .form-content {
            padding: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary-color);
        }

        .section-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        fieldset {
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 0;
            margin-bottom: 1.5rem;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        fieldset:hover {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        legend {
            font-weight: 600;
            color: var(--primary-color);
            padding: 0.75rem 1.5rem;
            margin: 0;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        legend::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        legend:hover::before {
            left: 100%;
        }

        legend:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        legend::after {
            content: '‚ñº';
            margin-left: auto;
            transition: transform 0.3s ease;
            font-size: 0.875rem;
        }

        .collapsed legend::after {
            transform: rotate(-90deg);
        }

        .fieldset-content {
            padding: 1.5rem;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .collapsed .fieldset-content {
            max-height: 0;
            padding: 0 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .form-grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        .form-grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .form-grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group.half-width {
            grid-column: span 2;
        }

        label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .required {
            color: var(--danger-color);
        }

        .tooltip {
            position: relative;
            cursor: help;
            color: var(--info-color);
            font-size: 0.875rem;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: var(--bg-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 250px;
            white-space: normal;
            box-shadow: var(--shadow-lg);
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 0.875rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .auto-calculated {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%) !important;
            color: var(--success-color) !important;
            font-weight: 600;
            border-color: var(--success-color) !important;
        }

        [data-theme="dark"] .auto-calculated {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%) !important;
            color: #34d399 !important;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-item:hover {
            background: var(--secondary-color);
            border-color: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 0.75rem;
            transform: scale(1.2);
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Action Buttons */
        .actions {
            position: sticky;
            bottom: 0;
            background: var(--bg-primary);
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 0.75rem;
            backdrop-filter: blur(10px);
        }

        button {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        /* Report Panel */
        .report-panel {
            width: 55%;
            background: var(--bg-tertiary);
            overflow-y: auto;
            max-height: calc(100vh - 70px);
            margin-top: 70px;
        }

        #report-output {
            background: var(--bg-primary);
            margin: 1.5rem;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-xl);
            min-height: calc(100vh - 140px);
            position: relative;
        }

        .placeholder-text {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: var(--text-light);
            text-align: center;
            font-size: 1.125rem;
        }

        .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        /* Report Styles */
        .report-header {
            text-align: center;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
        }

        .report-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        .hospital-logo {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .hospital-name {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .report-title {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: 700;
            margin: 0.5rem 0;
            letter-spacing: -0.025em;
        }

        .report-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .report-section {
            margin-bottom: 2rem;
            page-break-inside: avoid;
        }

        .report-section h3 {
            font-size: 1.25rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin: 0 0 1rem 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--primary-color);
        }

        .section-icon-report {
            font-size: 1.25rem;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .patient-card {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            background: var(--bg-primary);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        thead th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--primary-color);
            font-size: 0.875rem;
        }

        tbody tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-normal { color: var(--success-color); }
        .status-abnormal { color: var(--danger-color); }
        .status-borderline { color: var(--warning-color); }

        .highlight-red {
            color: var(--danger-color);
            font-weight: 700;
        }

        .highlight-yellow {
            color: var(--warning-color);
            font-weight: 700;
        }

        .highlight-green {
            color: var(--success-color);
            font-weight: 700;
        }

        .severity-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .severity-none { background: #f3f4f6; color: #6b7280; }
        .severity-trace { background: #dbeafe; color: #1d4ed8; }
        .severity-mild { background: #dcfce7; color: #166534; }
        .severity-moderate { background: #fef3c7; color: #92400e; }
        .severity-severe { background: #fee2e2; color: #991b1b; }

        .findings-list {
            list-style: none;
            padding: 0;
        }

        .findings-list li {
            position: relative;
            padding: 0.75rem 0 0.75rem 2rem;
            margin-bottom: 0.5rem;
            line-height: 1.6;
            background: var(--bg-secondary);
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary-color);
        }

        .findings-list li::before {
            content: '‚ñ∂';
            position: absolute;
            left: 0.75rem;
            top: 0.75rem;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 0.875rem;
        }

        .alert {
            padding: 1rem 1.25rem;
            margin: 1rem 0;
            border: 1px solid;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .alert-warning {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert-danger {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .alert-info {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .alert-success {
            background: #dcfce7;
            border-color: #10b981;
            color: #166534;
        }

        .report-footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            page-break-inside: avoid;
        }

        .signature-section {
            text-align: right;
        }

        .signature-line {
            width: 250px;
            border-top: 2px solid var(--text-primary);
            margin: 0 0 0.75rem auto;
        }

        .physician-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .physician-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .report-meta {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .disclaimer {
            grid-column: 1 / -1;
            margin-top: 2rem;
            font-size: 0.75rem;
            color: var(--text-light);
            text-align: center;
            border-top: 1px dashed var(--border-color);
            padding-top: 1rem;
            line-height: 1.5;
        }

        /* Measurement Cards */
        .measurement-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .measurement-card {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .measurement-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .measurement-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .measurement-range {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
                font-size: 12px;
            }
            
            .app-header,
            .form-panel,
            .actions,
            .theme-toggle {
                display: none !important;
            }
            
            .app-container {
                flex-direction: column;
                box-shadow: none;
                max-width: none;
                margin: 0;
            }
            
            .report-panel {
                width: 100%;
                margin-top: 0;
            }
            
            #report-output {
                margin: 0;
                padding: 1rem;
                box-shadow: none;
                border-radius: 0;
                min-height: auto;
            }
            
            .report-section {
                page-break-inside: avoid;
                margin-bottom: 1.5rem;
            }
            
            .report-header {
                margin-bottom: 1.5rem;
            }
            
            .report-title {
                font-size: 1.5rem;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 0.5rem;
            }
            
            .findings-list li {
                padding: 0.5rem 0 0.5rem 1.5rem;
                margin-bottom: 0.25rem;
            }
            
            .alert {
                padding: 0.75rem;
                margin: 0.75rem 0;
            }
            
            .measurement-cards {
                grid-template-columns: repeat(4, 1fr);
                gap: 0.5rem;
            }
            
            .measurement-card {
                padding: 0.75rem;
            }
            
            .measurement-value {
                font-size: 1.25rem;
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .app-container {
                flex-direction: column;
            }
            
            .form-panel,
            .report-panel {
                width: 100%;
                max-height: none;
            }
            
            .actions {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                padding: 0 1rem;
            }
            
            .app-title {
                font-size: 1.25rem;
            }
            
            .form-content {
                padding: 1rem;
            }
            
            .form-grid,
            .form-grid-2,
            .form-grid-3,
            .form-grid-4 {
                grid-template-columns: 1fr;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .actions {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            #report-output {
                margin: 1rem;
                padding: 1.5rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Validation Styles */
        .invalid {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }

        .valid {
            border-color: var(--success-color) !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Advanced Features */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .quick-action {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <div class="app-header">
        <div class="logo-section">
            <div class="logo">ü´Ä</div>
            <div>
                <div class="app-title">CardioVision Pro</div>
                <div class="app-subtitle">Advanced Echocardiography Report System</div>
            </div>
        </div>
        <div class="header-controls">
            <button class="theme-toggle" onclick="toggleTheme()">
                üåô Dark Mode
            </button>
        </div>
    </div>

    <div class="app-container">
        <!-- FORM PANEL -->
        <div class="form-panel">
            <div class="form-content">
                <div class="section-header">
                    <div class="section-icon">üìã</div>
                    <div class="section-title">Patient Data Entry</div>
                </div>

                <div class="quick-actions">
                    <div class="quick-action" onclick="loadTemplate('normal')">Normal Study</div>
                    <div class="quick-action" onclick="loadTemplate('abnormal')">Abnormal Study</div>
                    <div class="quick-action" onclick="loadTemplate('emergency')">Emergency</div>
                </div>

                <form id="report-form">
                    <!-- Patient Demographics & Clinical Info -->
                    <fieldset id="patient-info">
                        <legend onclick="toggleFieldset('patient-info')">
                            üë§ Patient Demographics & Clinical Information
                        </legend>
                        <div class="fieldset-content">
                            <div class="form-grid form-grid-2">
                                <div class="form-group">
                                    <label for="patientName">Patient Name <span class="required">*</span></label>
                                    <input type="text" id="patientName" value="Mohamed Saleck Sid Ahmed" required>
                                </div>
                                <div class="form-group">
                                    <label for="patientId">Patient ID <span class="required">*</span></label>
                                    <input type="text" id="patientId" value="380869" required>
                                </div>
                                <div class="form-group">
                                    <label for="age">Age (years) <span class="required">*</span></label>
                                    <input type="number" id="age" value="65" min="1" max="120" required onchange="calculateBSA()">
                                </div>
                                <div class="form-group">
                                    <label for="gender">Gender <span class="required">*</span></label>
                                    <select id="gender" required onchange="updateNormalRanges()">
                                        <option value="Male" selected>Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="height">Height (cm) <span class="required">*</span></label>
                                    <input type="number" id="height" value="175" min="100" max="250" required onchange="calculateBSA()">
                                </div>
                                <div class="form-group">
                                    <label for="weight">Weight (kg) <span class="required">*</span></label>
                                    <input type="number" id="weight" value="80" min="20" max="300" required onchange="calculateBSA()">
                                </div>
                                <div class="form-group">
                                    <label for="bsa">BSA (m¬≤) <span class="tooltip" data-tooltip="Body Surface Area - Auto calculated using DuBois formula">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="bsa" value="1.95" step="0.01" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="bmi">BMI (kg/m¬≤) <span class="tooltip" data-tooltip="Body Mass Index - Auto calculated">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="bmi" value="26.1" step="0.1" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="examDate">Exam Date <span class="required">*</span></label>
                                    <input type="date" id="examDate" value="2025-01-18" required>
                                </div>
                                <div class="form-group">
                                    <label for="examTime">Exam Time</label>
                                    <input type="time" id="examTime" value="14:30">
                                </div>
                                <div class="form-group">
                                    <label for="referringPhysician">Referring Physician</label>
                                    <input type="text" id="referringPhysician" value="Dr. HMN">
                                </div>
                                <div class="form-group">
                                    <label for="performingPhysician">Performing Physician <span class="required">*</span></label>
                                    <input type="text" id="performingPhysician" value="Dr. Ghiath Backdach" required>
                                </div>
                                <div class="form-group">
                                    <label for="hr">Heart Rate (bpm)</label>
                                    <input type="number" id="hr" value="72" min="30" max="200" onchange="calculateHemodynamics()">
                                </div>
                                <div class="form-group">
                                    <label for="bp">Blood Pressure (mmHg)</label>
                                    <input type="text" id="bp" value="140/90" placeholder="120/80">
                                </div>
                                <div class="form-group">
                                    <label for="o2Sat">O2 Saturation (%)</label>
                                    <input type="number" id="o2Sat" value="98" min="70" max="100">
                                </div>
                                <div class="form-group">
                                    <label for="studyQuality">Study Quality</label>
                                    <select id="studyQuality">
                                        <option value="Excellent">Excellent</option>
                                        <option value="Good" selected>Good</option>
                                        <option value="Fair">Fair</option>
                                        <option value="Poor">Poor</option>
                                        <option value="Limited">Limited</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="reasonForExam">Reason for Examination <span class="required">*</span></label>
                                <input type="text" id="reasonForExam" value="Diastolic murmur evaluation" required>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="clinicalHistory">Clinical History</label>
                                <textarea id="clinicalHistory" rows="3" placeholder="Enter relevant clinical history, symptoms, and previous cardiac interventions..."></textarea>
                            </div>
                            
                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Medical History</h4>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="htn">
                                    <label for="htn">Hypertension (HTN)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="dm">
                                    <label for="dm">Diabetes Mellitus (DM)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="cad">
                                    <label for="cad">Coronary Artery Disease (CAD)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="ckd">
                                    <label for="ckd">Chronic Kidney Disease (CKD)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="af">
                                    <label for="af">Atrial Fibrillation (AF)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hf">
                                    <label for="hf">Heart Failure (HF)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="copd">
                                    <label for="copd">COPD</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stroke">
                                    <label for="stroke">Previous Stroke/TIA</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="smoking">
                                    <label for="smoking">Smoking History</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="familyHx">
                                    <label for="familyHx">Family History of CAD</label>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="medications">Current Cardiac Medications</label>
                                <textarea id="medications" rows="2" placeholder="List current cardiac medications (ACE inhibitors, beta-blockers, diuretics, etc.)..."></textarea>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Left Heart Structure & Function -->
                    <fieldset id="left-heart">
                        <legend onclick="toggleFieldset('left-heart')">
                            ‚ù§Ô∏è Left Heart Structure & Function
                        </legend>
                        <div class="fieldset-content">
                            <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Left Ventricular Assessment</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="lvef">LVEF (Simpson's) % <span class="tooltip" data-tooltip="Normal: ‚â•53% (Male), ‚â•55% (Female)">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="lvef" value="45" min="5" max="80" onchange="validateMeasurement(this, 53, 77)">
                                </div>
                                <div class="form-group">
                                    <label for="lvefMethod">LVEF Method</label>
                                    <select id="lvefMethod">
                                        <option value="Simpson's Biplane" selected>Simpson's Biplane</option>
                                        <option value="Visual Estimation">Visual Estimation</option>
                                        <option value="M-Mode">M-Mode</option>
                                        <option value="3D Echo">3D Echo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="lvidd">LVIDd (mm) <span class="tooltip" data-tooltip="Normal: 42-59mm (Male), 39-53mm (Female)">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="lvidd" value="57" min="20" max="80" onchange="calculateLVMass(); validateMeasurement(this, 42, 59)">
                                </div>
                                <div class="form-group">
                                    <label for="lvids">LVIDs (mm) <span class="tooltip" data-tooltip="Normal: 25-40mm (Male), 22-35mm (Female)">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="lvids" value="50" min="15" max="70" onchange="calculateFS(); validateMeasurement(this, 25, 40)">
                                </div>
                                <div class="form-group">
                                    <label for="fs">Fractional Shortening (%) <span class="tooltip" data-tooltip="Auto-calculated: (LVIDd-LVIDs)/LVIDd √ó 100">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="fs" value="12" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="ivsd">IVSd (mm) <span class="tooltip" data-tooltip="Normal: 6-10mm (Male), 6-9mm (Female)">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="ivsd" value="9" min="5" max="25" onchange="calculateLVMass(); validateMeasurement(this, 6, 10)">
                                </div>
                                <div class="form-group">
                                    <label for="lvpwd">LVPWd (mm) <span class="tooltip" data-tooltip="Normal: 6-10mm (Male), 6-9mm (Female)">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="lvpwd" value="11" min="5" max="25" onchange="calculateLVMass(); validateMeasurement(this, 6, 10)">
                                </div>
                                <div class="form-group">
                                    <label for="lvmass">LV Mass (g) <span class="tooltip" data-tooltip="Auto-calculated using ASE formula">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="lvmass" value="185" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="lvmassIndex">LV Mass Index (g/m¬≤) <span class="tooltip" data-tooltip="Normal: 50-102 g/m¬≤ (Male), 44-88 g/m¬≤ (Female)">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="lvmassIndex" value="95" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="rwt">Relative Wall Thickness <span class="tooltip" data-tooltip="Auto-calculated: 2√óLVPWd/LVIDd">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="rwt" value="0.39" step="0.01" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="lvGeometry">LV Geometry <span class="tooltip" data-tooltip="Auto-determined from mass index and RWT">‚ÑπÔ∏è</span></label>
                                    <input type="text" id="lvGeometry" value="Concentric Remodeling" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="gls">Global Longitudinal Strain (%) <span class="tooltip" data-tooltip="Normal: ‚â§-18%">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="gls" value="-12" min="-30" max="0" step="0.1" onchange="validateMeasurement(this, -30, -18)">
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Left Atrial Assessment</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="laArea">LA Area (cm¬≤) <span class="tooltip" data-tooltip="Normal: ‚â§20 cm¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="laArea" value="23" min="5" max="50" step="0.1" onchange="validateMeasurement(this, 0, 20)">
                                </div>
                                <div class="form-group">
                                    <label for="laVolume">LA Volume (ml) <span class="tooltip" data-tooltip="Left atrial volume by Simpson's method">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="laVolume" value="68" min="10" max="200" onchange="calculateLAVolumeIndex()">
                                </div>
                                <div class="form-group">
                                    <label for="laVolumeIndex">LA Volume Index (ml/m¬≤) <span class="tooltip" data-tooltip="Normal: ‚â§34 ml/m¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="laVolumeIndex" value="35" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="laDiameter">LA Diameter (mm) <span class="tooltip" data-tooltip="Normal: ‚â§40mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="laDiameter" value="42" min="20" max="70">
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Aortic Root & Ascending Aorta</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="aorticRoot">Aortic Root (mm) <span class="tooltip" data-tooltip="Normal: 20-37mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="aorticRoot" value="32" min="15" max="60" onchange="validateMeasurement(this, 20, 37)">
                                </div>
                                <div class="form-group">
                                    <label for="ascAorta">Ascending Aorta (mm) <span class="tooltip" data-tooltip="Normal: 19-35mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="ascAorta" value="21" min="15" max="60" onchange="validateMeasurement(this, 19, 35)">
                                </div>
                                <div class="form-group">
                                    <label for="aorticArch">Aortic Arch (mm)</label>
                                    <input type="number" id="aorticArch" value="25" min="15" max="50">
                                </div>
                                <div class="form-group">
                                    <label for="sov">Sinus of Valsalva (mm)</label>
                                    <input type="number" id="sov" value="30" min="15" max="50">
                                </div>
                                <div class="form-group">
                                    <label for="stj">Sinotubular Junction (mm)</label>
                                    <input type="number" id="stj" value="28" min="15" max="45">
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Right Heart Assessment -->
                    <fieldset id="right-heart">
                        <legend onclick="toggleFieldset('right-heart')">
                            üíô Right Heart Assessment
                        </legend>
                        <div class="fieldset-content">
                            <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Right Ventricular Function</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="rvot">RVOT (mm) <span class="tooltip" data-tooltip="Normal: 19-35mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="rvot" value="24" min="10" max="50" onchange="validateMeasurement(this, 19, 35)">
                                </div>
                                <div class="form-group">
                                    <label for="rvedd">RV End-Diastolic Diameter (mm) <span class="tooltip" data-tooltip="Normal: 19-42mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="rvedd" value="32" min="15" max="70" onchange="validateMeasurement(this, 19, 42)">
                                </div>
                                <div class="form-group">
                                    <label for="rvLength">RV Length (mm) <span class="tooltip" data-tooltip="Normal: 59-83mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="rvLength" value="70" min="40" max="100">
                                </div>
                                <div class="form-group">
                                    <label for="tapse">TAPSE (mm) <span class="tooltip" data-tooltip="Normal: ‚â•17mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="tapse" value="18" min="5" max="40" onchange="validateMeasurement(this, 17, 40)">
                                </div>
                                <div class="form-group">
                                    <label for="rvFac">RV FAC (%) <span class="tooltip" data-tooltip="Normal: ‚â•35%">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="rvFac" value="35" min="10" max="70" onchange="validateMeasurement(this, 35, 70)">
                                </div>
                                <div class="form-group">
                                    <label for="sPrime">RV S' (cm/s) <span class="tooltip" data-tooltip="Normal: ‚â•9.5 cm/s">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="sPrime" value="10" min="3" max="20" step="0.1" onchange="validateMeasurement(this, 9.5, 20)">
                                </div>
                                <div class="form-group">
                                    <label for="rvsp">RVSP (mmHg) <span class="tooltip" data-tooltip="Right ventricular systolic pressure from TR jet">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="rvsp" value="35" min="15" max="100" onchange="calculatePASP()">
                                </div>
                                <div class="form-group">
                                    <label for="rvFunction">RV Function</label>
                                    <select id="rvFunction">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Mildly Reduced">Mildly Reduced</option>
                                        <option value="Moderately Reduced">Moderately Reduced</option>
                                        <option value="Severely Reduced">Severely Reduced</option>
                                    </select>
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Right Atrial Assessment</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="raArea">RA Area (cm¬≤) <span class="tooltip" data-tooltip="Normal: <18 cm¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="raArea" value="15" min="5" max="40" step="0.1" onchange="validateMeasurement(this, 0, 18)">
                                </div>
                                <div class="form-group">
                                    <label for="raVolume">RA Volume (ml)</label>
                                    <input type="number" id="raVolume" value="45" min="10" max="150">
                                </div>
                                <div class="form-group">
                                    <label for="raVolumeIndex">RA Volume Index (ml/m¬≤) <span class="tooltip" data-tooltip="Normal: <33 ml/m¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="raVolumeIndex" value="23" class="auto-calculated" readonly>
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Pulmonary Pressures & IVC</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="ivc">IVC Diameter (mm) <span class="tooltip" data-tooltip="Normal: 15-25mm">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="ivc" value="18" min="8" max="40" onchange="validateMeasurement(this, 15, 25)">
                                </div>
                                <div class="form-group">
                                    <label for="ivcCollapse">IVC Collapsibility (%)</label>
                                    <input type="number" id="ivcCollapse" value="60" min="0" max="100" onchange="calculateRAPressure()">
                                </div>
                                <div class="form-group">
                                    <label for="raPressure">RA Pressure (mmHg) <span class="tooltip" data-tooltip="Estimated from IVC size and collapsibility">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="raPressure" value="8" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="pasp">PASP (mmHg) <span class="tooltip" data-tooltip="RVSP + RAP">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="pasp" value="43" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="padp">PADP (mmHg) <span class="tooltip" data-tooltip="Pulmonary artery diastolic pressure">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="padp" value="15" min="5" max="50">
                                </div>
                                <div class="form-group">
                                    <label for="pht">Pulmonary Hypertension</label>
                                    <select id="pht">
                                        <option value="None" selected>None</option>
                                        <option value="Mild">Mild (36-50 mmHg)</option>
                                        <option value="Moderate">Moderate (51-60 mmHg)</option>
                                        <option value="Severe">Severe (>60 mmHg)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Diastolic Function Assessment -->
                    <fieldset id="diastolic">
                        <legend onclick="toggleFieldset('diastolic')">
                            üîÑ Diastolic Function Assessment
                        </legend>
                        <div class="fieldset-content">
                            <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Mitral Inflow Parameters</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="eWave">Mitral E Wave (m/s)</label>
                                    <input type="number" id="eWave" value="0.32" min="0.1" max="3" step="0.01" onchange="calculateDiastolic()">
                                </div>
                                <div class="form-group">
                                    <label for="aWave">Mitral A Wave (m/s)</label>
                                    <input type="number" id="aWave" value="0.51" min="0.1" max="3" step="0.01" onchange="calculateDiastolic()">
                                </div>
                                <div class="form-group">
                                    <label for="eaRatio">E/A Ratio <span class="tooltip" data-tooltip="Auto-calculated">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="eaRatio" value="0.63" step="0.01" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="dt">Deceleration Time (ms) <span class="tooltip" data-tooltip="Normal: 160-240ms">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="dt" value="280" min="50" max="500" onchange="validateMeasurement(this, 160, 240)">
                                </div>
                                <div class="form-group">
                                    <label for="ivrt">IVRT (ms) <span class="tooltip" data-tooltip="Normal: 70-100ms">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="ivrt" value="120" min="30" max="200" onchange="validateMeasurement(this, 70, 100)">
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Tissue Doppler Parameters</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="ePrime">E' Septal (cm/s) <span class="tooltip" data-tooltip="Normal: ‚â•7 cm/s">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="ePrime" value="6" min="1" max="20" step="0.1" onchange="calculateDiastolic(); validateMeasurement(this, 7, 20)">
                                </div>
                                <div class="form-group">
                                    <label for="ePrimeLat">E' Lateral (cm/s) <span class="tooltip" data-tooltip="Normal: ‚â•10 cm/s">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="ePrimeLat" value="8" min="1" max="25" step="0.1" onchange="calculateDiastolic(); validateMeasurement(this, 10, 25)">
                                </div>
                                <div class="form-group">
                                    <label for="ePrimeAvg">E' Average (cm/s) <span class="tooltip" data-tooltip="Auto-calculated average">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="ePrimeAvg" value="7" step="0.1" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="eePrime">E/E' Ratio <span class="tooltip" data-tooltip="Auto-calculated">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="eePrime" value="4.6" step="0.1" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="aPrimeSep">A' Septal (cm/s)</label>
                                    <input type="number" id="aPrimeSep" value="8" min="1" max="20" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="aPrimeLat">A' Lateral (cm/s)</label>
                                    <input type="number" id="aPrimeLat" value="10" min="1" max="25" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="sPrimeSep">S' Septal (cm/s)</label>
                                    <input type="number" id="sPrimeSep" value="7" min="1" max="15" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="sPrimeLat">S' Lateral (cm/s)</label>
                                    <input type="number" id="sPrimeLat" value="9" min="1" max="20" step="0.1">
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Pulmonary Venous Flow</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="sPulm">Pulmonary S Wave (m/s)</label>
                                    <input type="number" id="sPulm" value="0.55" min="0.1" max="2" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="dPulm">Pulmonary D Wave (m/s)</label>
                                    <input type="number" id="dPulm" value="0.35" min="0.1" max="2" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="arDuration">AR Duration (ms)</label>
                                    <input type="number" id="arDuration" value="150" min="50" max="300">
                                </div>
                                <div class="form-group">
                                    <label for="sdRatio">S/D Ratio <span class="tooltip" data-tooltip="Auto-calculated">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="sdRatio" value="1.57" step="0.01" class="auto-calculated" readonly>
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Diastolic Function Grade</h4>
                            <div class="form-grid form-grid-2">
                                <div class="form-group">
                                    <label for="diastolicGrade">DD Grade <span class="tooltip" data-tooltip="Auto-calculated based on parameters">‚ÑπÔ∏è</span></label>
                                    <input type="text" id="diastolicGrade" value="Grade I (Impaired Relaxation)" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="fillingPressures">LV Filling Pressures</label>
                                    <select id="fillingPressures">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Elevated">Elevated</option>
                                        <option value="Indeterminate">Indeterminate</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- LVOT & Hemodynamics -->
                    <fieldset id="hemodynamics">
                        <legend onclick="toggleFieldset('hemodynamics')">
                            üî¨ LVOT & Hemodynamic Assessment
                        </legend>
                        <div class="fieldset-content">
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="lvotDiameter">LVOT Diameter (mm)</label>
                                    <input type="number" id="lvotDiameter" value="20" min="10" max="35" onchange="calculateHemodynamics()">
                                </div>
                                <div class="form-group">
                                    <label for="lvotVti">LVOT VTI (cm)</label>
                                    <input type="number" id="lvotVti" value="18" min="5" max="40" step="0.1" onchange="calculateHemodynamics()">
                                </div>
                                <div class="form-group">
                                    <label for="lvotArea">LVOT Area (cm¬≤) <span class="tooltip" data-tooltip="Auto-calculated: œÄ √ó (diameter/2)¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="lvotArea" value="3.14" step="0.01" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="strokeVolume">Stroke Volume (ml) <span class="tooltip" data-tooltip="VTI √ó LVOT Area">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="strokeVolume" value="57" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="cardiacOutput">Cardiac Output (L/min) <span class="tooltip" data-tooltip="SV √ó HR / 1000">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="cardiacOutput" value="4.1" step="0.1" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="cardiacIndex">Cardiac Index (L/min/m¬≤) <span class="tooltip" data-tooltip="CO / BSA">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="cardiacIndex" value="2.1" step="0.1" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="svr">SVR (dynes¬∑s/cm‚Åµ) <span class="tooltip" data-tooltip="Systemic Vascular Resistance">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="svr" value="1200" min="500" max="3000">
                                </div>
                                <div class="form-group">
                                    <label for="svri">SVRI (dynes¬∑s¬∑m¬≤/cm‚Åµ) <span class="tooltip" data-tooltip="SVR √ó BSA">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="svri" value="2340" class="auto-calculated" readonly>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Comprehensive Valve Assessment -->
                    <fieldset id="valves">
                        <legend onclick="toggleFieldset('valves')">
                            ü´Ä Comprehensive Valve Assessment
                        </legend>
                        <div class="fieldset-content">
                            <!-- Aortic Valve -->
                            <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Aortic Valve</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="avMorphology">AV Morphology</label>
                                    <select id="avMorphology">
                                        <option value="Tricuspid" selected>Tricuspid</option>
                                        <option value="Bicuspid">Bicuspid</option>
                                        <option value="Unicuspid">Unicuspid</option>
                                        <option value="Quadricuspid">Quadricuspid</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="avArea">AV Area (cm¬≤) <span class="tooltip" data-tooltip="Normal: >2.0 cm¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="avArea" value="2.1" min="0.5" max="4" step="0.1" onchange="validateMeasurement(this, 2.0, 4.0)">
                                </div>
                                <div class="form-group">
                                    <label for="avMaxVel">AV Peak Velocity (m/s)</label>
                                    <input type="number" id="avMaxVel" value="1.8" min="0.5" max="6" step="0.1" onchange="calculateAVGradients()">
                                </div>
                                <div class="form-group">
                                    <label for="avMeanGrad">AV Mean Gradient (mmHg) <span class="tooltip" data-tooltip="Auto-calculated from velocity">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="avMeanGrad" value="8" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="avMaxGrad">AV Peak Gradient (mmHg) <span class="tooltip" data-tooltip="Auto-calculated: 4 √ó Vmax¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="avMaxGrad" value="13" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="avVti">AV VTI (cm)</label>
                                    <input type="number" id="avVti" value="45" min="10" max="150" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="avStenosis">AS Severity</label>
                                    <select id="avStenosis">
                                        <option value="None" selected>None</option>
                                        <option value="Mild">Mild</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Severe">Severe</option>
                                        <option value="Critical">Critical</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="arSeverity">AR Severity</label>
                                    <select id="arSeverity">
                                        <option value="None">None</option>
                                        <option value="Trace" selected>Trace</option>
                                        <option value="Mild">Mild</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Severe">Severe</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="arJetWidth">AR Jet Width (%)</label>
                                    <input type="number" id="arJetWidth" value="15" min="0" max="100">
                                </div>
                                <div class="form-group">
                                    <label for="arVc">AR Vena Contracta (cm)</label>
                                    <input type="number" id="arVc" value="" min="0" max="1" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="arRegVol">AR Regurgitant Volume (ml)</label>
                                    <input type="number" id="arRegVol" value="" min="0" max="150">
                                </div>
                                <div class="form-group">
                                    <label for="arEroa">AR EROA (cm¬≤)</label>
                                    <input type="number" id="arEroa" value="" min="0" max="1" step="0.01">
                                </div>
                            </div>

                            <!-- Mitral Valve -->
                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Mitral Valve</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="mvMorphology">MV Morphology</label>
                                    <select id="mvMorphology">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Rheumatic">Rheumatic</option>
                                        <option value="Degenerative">Degenerative</option>
                                        <option value="Ischemic">Ischemic</option>
                                        <option value="Functional">Functional</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="mvArea">MV Area (cm¬≤) <span class="tooltip" data-tooltip="Normal: >2.5 cm¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="mvArea" value="4.2" min="0.5" max="8" step="0.1" onchange="validateMeasurement(this, 2.5, 8.0)">
                                </div>
                                <div class="form-group">
                                    <label for="mvMeanGrad">MV Mean Gradient (mmHg)</label>
                                    <input type="number" id="mvMeanGrad" value="3" min="1" max="50">
                                </div>
                                <div class="form-group">
                                    <label for="mvHalfTime">MV Pressure Half-time (ms)</label>
                                    <input type="number" id="mvHalfTime" value="" min="50" max="300">
                                </div>
                                <div class="form-group">
                                    <label for="mvStenosis">MS Severity</label>
                                    <select id="mvStenosis">
                                        <option value="None" selected>None</option>
                                        <option value="Mild">Mild</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Severe">Severe</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="mrSeverity">MR Severity</label>
                                    <select id="mrSeverity">
                                        <option value="None">None</option>
                                        <option value="Trace" selected>Trace</option>
                                        <option value="Mild">Mild</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Severe">Severe</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="mrMechanism">MR Mechanism</label>
                                    <select id="mrMechanism">
                                        <option value="None" selected>None</option>
                                        <option value="Functional">Functional</option>
                                        <option value="Degenerative">Degenerative</option>
                                        <option value="Rheumatic">Rheumatic</option>
                                        <option value="Ischemic">Ischemic</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="mrJetArea">MR Jet Area (cm¬≤)</label>
                                    <input type="number" id="mrJetArea" value="" min="0" max="20" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="mrVc">MR Vena Contracta (cm)</label>
                                    <input type="number" id="mrVc" value="" min="0" max="1" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="mrPisa">MR PISA Radius (cm)</label>
                                    <input type="number" id="mrPisa" value="" min="0" max="2" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="mrRegVol">MR Regurgitant Volume (ml)</label>
                                    <input type="number" id="mrRegVol" value="" min="0" max="150">
                                </div>
                                <div class="form-group">
                                    <label for="mrEroa">MR EROA (cm¬≤)</label>
                                    <input type="number" id="mrEroa" value="" min="0" max="1" step="0.01">
                                </div>
                            </div>

                            <!-- Wilkins Score for Mitral Stenosis -->
                            <h5 style="margin: 1rem 0 0.5rem 0; color: var(--text-secondary);">Wilkins Score (for Mitral Stenosis)</h5>
                            <div class="form-grid form-grid-4">
                                <div class="form-group">
                                    <label for="wilkinsMobility">Mobility</label>
                                    <select id="wilkinsMobility">
                                        <option value="1">1 - Highly mobile</option>
                                        <option value="2" selected>2 - Normal mobility</option>
                                        <option value="3">3 - Reduced mobility</option>
                                        <option value="4">4 - Immobile</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="wilkinsThickness">Thickness</label>
                                    <select id="wilkinsThickness">
                                        <option value="1">1 - Normal (4-5mm)</option>
                                        <option value="2" selected>2 - Mid-leaflet thickening</option>
                                        <option value="3">3 - Entire leaflet thickening</option>
                                        <option value="4">4 - Marked thickening</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="wilkinsCalc">Calcification</label>
                                    <select id="wilkinsCalc">
                                        <option value="1">1 - Single echo brightness</option>
                                        <option value="2" selected>2 - Scattered bright echoes</option>
                                        <option value="3">3 - Brightness confined to margins</option>
                                        <option value="4">4 - Extensive brightness</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="wilkinsSubval">Subvalvular</label>
                                    <select id="wilkinsSubval">
                                        <option value="1">1 - Minimal thickening</option>
                                        <option value="2" selected>2 - Chordal thickening</option>
                                        <option value="3">3 - Thickening extending to papillary</option>
                                        <option value="4">4 - Extensive thickening</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="wilkinsTotal">Total Score <span class="tooltip" data-tooltip="Auto-calculated sum">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="wilkinsTotal" value="8" class="auto-calculated" readonly>
                                </div>
                            </div>

                            <!-- Tricuspid Valve -->
                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Tricuspid Valve</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="tvMorphology">TV Morphology</label>
                                    <select id="tvMorphology">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Rheumatic">Rheumatic</option>
                                        <option value="Functional">Functional</option>
                                        <option value="Ebstein's">Ebstein's Anomaly</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="tvMaxVel">TV Max Velocity (m/s)</label>
                                    <input type="number" id="tvMaxVel" value="2.1" min="0.5" max="5" step="0.1" onchange="calculateTVGradient()">
                                </div>
                                <div class="form-group">
                                    <label for="tvMaxGrad">TV Peak Gradient (mmHg) <span class="tooltip" data-tooltip="Auto-calculated: 4 √ó Vmax¬≤">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="tvMaxGrad" value="18" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="trSeverity">TR Severity</label>
                                    <select id="trSeverity">
                                        <option value="None">None</option>
                                        <option value="Trace" selected>Trace</option>
                                        <option value="Mild">Mild</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Severe">Severe</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="trJetArea">TR Jet Area (cm¬≤)</label>
                                    <input type="number" id="trJetArea" value="" min="0" max="15" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="trVc">TR Vena Contracta (cm)</label>
                                    <input type="number" id="trVc" value="" min="0" max="1" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="trPisa">TR PISA Radius (cm)</label>
                                    <input type="number" id="trPisa" value="" min="0" max="2" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="trRegVol">TR Regurgitant Volume (ml)</label>
                                    <input type="number" id="trRegVol" value="" min="0" max="150">
                                </div>
                                <div class="form-group">
                                    <label for="trEroa">TR EROA (cm¬≤)</label>
                                    <input type="number" id="trEroa" value="" min="0" max="1" step="0.01">
                                </div>
                            </div>

                            <!-- Pulmonary Valve -->
                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Pulmonary Valve</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="pvMorphology">PV Morphology</label>
                                    <select id="pvMorphology">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Stenotic">Stenotic</option>
                                        <option value="Dysplastic">Dysplastic</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="pvMaxVel">PV Peak Velocity (m/s)</label>
                                    <input type="number" id="pvMaxVel" value="1.2" min="0.5" max="5" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="pvMaxGrad">PV Peak Gradient (mmHg)</label>
                                    <input type="number" id="pvMaxGrad" value="6" min="1" max="100">
                                </div>
                                <div class="form-group">
                                    <label for="psSeverity">PS Severity</label>
                                    <select id="psSeverity">
                                        <option value="None" selected>None</option>
                                        <option value="Mild">Mild</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Severe">Severe</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prSeverity">PR Severity</label>
                                    <select id="prSeverity">
                                        <option value="None" selected>None</option>
                                        <option value="Trace">Trace</option>
                                        <option value="Mild">Mild</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Severe">Severe</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prJetWidth">PR Jet Width (%)</label>
                                    <input type="number" id="prJetWidth" value="" min="0" max="100">
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Regional Wall Motion Analysis -->
                    <fieldset id="wall-motion">
                        <legend onclick="toggleFieldset('wall-motion')">
                            üß± Regional Wall Motion Analysis
                        </legend>
                        <div class="fieldset-content">
                            <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">17-Segment Model Assessment</h4>
                            
                            <h5 style="margin: 1rem 0 0.5rem 0; color: var(--text-secondary);">Basal Segments</h5>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="basalAnterior">Basal Anterior</label>
                                    <select id="basalAnterior">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="basalAnteroseptal">Basal Anteroseptal</label>
                                    <select id="basalAnteroseptal">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="basalInferoseptal">Basal Inferoseptal</label>
                                    <select id="basalInferoseptal">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="basalInferior">Basal Inferior</label>
                                    <select id="basalInferior">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="basalInferolateral">Basal Inferolateral</label>
                                    <select id="basalInferolateral">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="basalAnterolateral">Basal Anterolateral</label>
                                    <select id="basalAnterolateral">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                            </div>

                            <h5 style="margin: 1rem 0 0.5rem 0; color: var(--text-secondary);">Mid Segments</h5>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="midAnterior">Mid Anterior</label>
                                    <select id="midAnterior">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="midAnteroseptal">Mid Anteroseptal</label>
                                    <select id="midAnteroseptal">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="midInferoseptal">Mid Inferoseptal</label>
                                    <select id="midInferoseptal">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="midInferior">Mid Inferior</label>
                                    <select id="midInferior">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="midInferolateral">Mid Inferolateral</label>
                                    <select id="midInferolateral">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="midAnterolateral">Mid Anterolateral</label>
                                    <select id="midAnterolateral">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                            </div>

                            <h5 style="margin: 1rem 0 0.5rem 0; color: var(--text-secondary);">Apical Segments</h5>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="apicalAnterior">Apical Anterior</label>
                                    <select id="apicalAnterior">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="apicalSeptal">Apical Septal</label>
                                    <select id="apicalSeptal">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="apicalInferior">Apical Inferior</label>
                                    <select id="apicalInferior">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="apicalLateral">Apical Lateral</label>
                                    <select id="apicalLateral">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="apex">Apex</label>
                                    <select id="apex">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Hypokinetic">Hypokinetic</option>
                                        <option value="Akinetic">Akinetic</option>
                                        <option value="Dyskinetic">Dyskinetic</option>
                                        <option value="Aneurysmal">Aneurysmal</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-grid form-grid-2">
                                <div class="form-group">
                                    <label for="wmsi">Wall Motion Score Index <span class="tooltip" data-tooltip="Auto-calculated from segment scores">‚ÑπÔ∏è</span></label>
                                    <input type="number" id="wmsi" value="1.0" step="0.1" class="auto-calculated" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="coronaryTerritory">Suspected Coronary Territory</label>
                                    <select id="coronaryTerritory">
                                        <option value="None" selected>None</option>
                                        <option value="LAD">LAD Territory</option>
                                        <option value="RCA">RCA Territory</option>
                                        <option value="LCX">LCX Territory</option>
                                        <option value="Multi-vessel">Multi-vessel</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Additional Findings -->
                    <fieldset id="additional-findings">
                        <legend onclick="toggleFieldset('additional-findings')">
                            üîç Additional Findings & Pathology
                        </legend>
                        <div class="fieldset-content">
                            <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Pericardium</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="pericardialEffusion">Pericardial Effusion</label>
                                    <select id="pericardialEffusion">
                                        <option value="None" selected>None</option>
                                        <option value="Trace">Trace</option>
                                        <option value="Small">Small</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Large">Large</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="tamponade">Tamponade Physiology</label>
                                    <select id="tamponade">
                                        <option value="No" selected>No</option>
                                        <option value="Possible">Possible</option>
                                        <option value="Present">Present</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="pericardialThickening">Pericardial Thickening</label>
                                    <select id="pericardialThickening">
                                        <option value="No" selected>No</option>
                                        <option value="Yes">Yes</option>
                                    </select>
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Masses & Thrombi</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="laThrombus">LA Thrombus/SEC</label>
                                    <select id="laThrombus">
                                        <option value="None" selected>None</option>
                                        <option value="SEC">Spontaneous Echo Contrast</option>
                                        <option value="Thrombus">Thrombus</option>
                                        <option value="Mass">Mass</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="lvThrombus">LV Thrombus</label>
                                    <select id="lvThrombus">
                                        <option value="None" selected>None</option>
                                        <option value="Possible">Possible</option>
                                        <option value="Present">Present</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="vegetation">Vegetation</label>
                                    <select id="vegetation">
                                        <option value="None" selected>None</option>
                                        <option value="Possible">Possible</option>
                                        <option value="Present">Present</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="vegetationLocation">Vegetation Location</label>
                                    <select id="vegetationLocation">
                                        <option value="None" selected>None</option>
                                        <option value="Aortic Valve">Aortic Valve</option>
                                        <option value="Mitral Valve">Mitral Valve</option>
                                        <option value="Tricuspid Valve">Tricuspid Valve</option>
                                        <option value="Pulmonary Valve">Pulmonary Valve</option>
                                        <option value="Multiple">Multiple</option>
                                    </select>
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Prosthetic Valves</h4>
                            <div class="form-grid form-grid-3">
                                <div class="form-group">
                                    <label for="prostheticAV">Prosthetic Aortic Valve</label>
                                    <select id="prostheticAV">
                                        <option value="None" selected>None</option>
                                        <option value="Mechanical">Mechanical</option>
                                        <option value="Bioprosthetic">Bioprosthetic</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prostheticMV">Prosthetic Mitral Valve</label>
                                    <select id="prostheticMV">
                                        <option value="None" selected>None</option>
                                        <option value="Mechanical">Mechanical</option>
                                        <option value="Bioprosthetic">Bioprosthetic</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prostheticFunction">Prosthetic Function</label>
                                    <select id="prostheticFunction">
                                        <option value="Normal" selected>Normal</option>
                                        <option value="Stenosis">Stenosis</option>
                                        <option value="Regurgitation">Regurgitation</option>
                                        <option value="Both">Both</option>
                                        <option value="Dysfunction">Dysfunction</option>
                                    </select>
                                </div>
                            </div>

                            <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Congenital Abnormalities</h4>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="asd">
                                    <label for="asd">Atrial Septal Defect (ASD)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="vsd">
                                    <label for="vsd">Ventricular Septal Defect (VSD)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="pda">
                                    <label for="pda">Patent Ductus Arteriosus (PDA)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="pfo">
                                    <label for="pfo">Patent Foramen Ovale (PFO)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="coarctation">
                                    <label for="coarctation">Coarctation of Aorta</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="bicuspidAV">
                                    <label for="bicuspidAV">Bicuspid Aortic Valve</label>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label for="additionalFindings">Additional Findings & Comments</label>
                                <textarea id="additionalFindings" rows="4" placeholder="Describe any additional findings, technical limitations, or clinical correlations..."></textarea>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Auto-interpretation & Clinical Correlation -->
                    <fieldset id="auto-interpretation">
                        <legend onclick="toggleFieldset('auto-interpretation')">
                            üß† Auto-interpretation & Clinical Correlation
                        </legend>
                        <div class="fieldset-content">
                            <div class="quick-actions">
                                <div class="quick-action" onclick="autoInterpret()">üß† Auto Interpret</div>
                                <div class="quick-action" onclick="generateSummary()">üìä Generate Summary</div>
                                <div class="quick-action" onclick="checkGuidelines()">üìã Check Guidelines</div>
                            </div>

                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-lv-dilated">
                                    <label for="chk-lv-dilated">LV dilation with reduced systolic function</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-lv-hypertrophy">
                                    <label for="chk-lv-hypertrophy">LV hypertrophy</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-rv-dysfunction">
                                    <label for="chk-rv-dysfunction">RV dysfunction</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-la-dilated">
                                    <label for="chk-la-dilated">LA dilation</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-ra-dilated">
                                    <label for="chk-ra-dilated">RA dilation</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-diastolic-dys">
                                    <label for="chk-diastolic-dys">Diastolic dysfunction</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-valve-disease">
                                    <label for="chk-valve-disease">Significant valve disease</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-pulm-htn">
                                    <label for="chk-pulm-htn">Pulmonary hypertension</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-wall-motion">
                                    <label for="chk-wall-motion">Regional wall motion abnormalities</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chk-pericardial">
                                    <label for="chk-pericardial">Pericardial abnormalities</label>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label for="clinicalCorrelation">Clinical Correlation & Recommendations</label>
                                <textarea id="clinicalCorrelation" rows="4" placeholder="Clinical correlation, follow-up recommendations, and suggested additional studies..."></textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="reportUrgency">Report Urgency</label>
                                <select id="reportUrgency">
                                    <option value="Routine" selected>Routine</option>
                                    <option value="Urgent">Urgent</option>
                                    <option value="STAT">STAT</option>
                                    <option value="Critical">Critical</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>

            <div class="actions">
                <button type="button" class="btn-primary" onclick="generateReport()">
                    üìã Generate Report
                </button>
                <button type="button" class="btn-info" onclick="autoInterpret()">
                    üß† Auto Interpret
                </button>
                <button type="button" class="btn-success" onclick="window.print()">
                    üñ®Ô∏è Print / PDF
                </button>
                <button type="button" class="btn-secondary" onclick="resetForm()">
                    üîÑ Reset
                </button>
            </div>
        </div>

        <!-- REPORT PANEL -->
        <div class="report-panel">
            <div id="report-output">
                <div class="placeholder-text">
                    <div class="placeholder-icon">ü´Ä</div>
                    <div>Professional Echocardiography Report Generator</div>
                    <div style="font-size: 1rem; margin-top: 0.5rem; color: var(--text-secondary);">
                        Complete the form and click "Generate Report" to create a comprehensive professional report
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTheme = localStorage.getItem('theme') || 'light';
        
        // Initialize theme
        if (currentTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }

        // Theme toggle
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            
            const button = document.querySelector('.theme-toggle');
            button.textContent = currentTheme === 'light' ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode';
        }

        // Fieldset toggle
        function toggleFieldset(id) {
            const fieldset = document.getElementById(id);
            fieldset.classList.toggle('collapsed');
        }

        // Validation functions
        function validateMeasurement(input, min, max) {
            const value = parseFloat(input.value);
            input.classList.remove('valid', 'invalid');
            
            if (isNaN(value)) return;
            
            if ((min !== null && value < min) || (max !== null && value > max)) {
                input.classList.add('invalid');
            } else {
                input.classList.add('valid');
            }
        }

        // Calculation functions
        function calculateBSA() {
            const height = parseFloat(document.getElementById('height').value) || 0;
            const weight = parseFloat(document.getElementById('weight').value) || 0;
            
            if (height > 0 && weight > 0) {
                // DuBois formula
                const bsa = 0.007184 * Math.pow(weight, 0.425) * Math.pow(height, 0.725);
                document.getElementById('bsa').value = bsa.toFixed(2);
                
                // BMI calculation
                const bmi = weight / Math.pow(height / 100, 2);
                document.getElementById('bmi').value = bmi.toFixed(1);
                
                // Update dependent calculations
                calculateLVMass();
                calculateLAVolumeIndex();
                calculateHemodynamics();
            }
        }

        function calculateLVMass() {
            const lvidd = parseFloat(document.getElementById('lvidd').value) || 0;
            const ivsd = parseFloat(document.getElementById('ivsd').value) || 0;
            const lvpwd = parseFloat(document.getElementById('lvpwd').value) || 0;
            const bsa = parseFloat(document.getElementById('bsa').value) || 1;
            
            if (lvidd > 0 && ivsd > 0 && lvpwd > 0) {
                // ASE formula: 0.8 √ó {1.04[(LVIDd + IVSd + LVPWd)¬≥ - LVIDd¬≥]} + 0.6
                const lvmass = 0.8 * (1.04 * (Math.pow(lvidd + ivsd + lvpwd, 3) - Math.pow(lvidd, 3))) + 0.6;
                const lvmassIndex = lvmass / bsa;
                
                // Relative Wall Thickness
                const rwt = (2 * lvpwd) / lvidd;
                
                // LV Geometry
                let geometry = "Normal";
                const gender = document.getElementById('gender').value;
                const normalMassIndex = gender === 'Male' ? 102 : 88;
                
                if (lvmassIndex > normalMassIndex) {
                    geometry = rwt > 0.42 ? "Concentric Hypertrophy" : "Eccentric Hypertrophy";
                } else {
                    geometry = rwt > 0.42 ? "Concentric Remodeling" : "Normal Geometry";
                }
                
                document.getElementById('lvmass').value = Math.round(lvmass);
                document.getElementById('lvmassIndex').value = Math.round(lvmassIndex);
                document.getElementById('rwt').value = rwt.toFixed(2);
                document.getElementById('lvGeometry').value = geometry;
            }
        }

        function calculateFS() {
            const lvidd = parseFloat(document.getElementById('lvidd').value) || 0;
            const lvids = parseFloat(document.getElementById('lvids').value) || 0;
            
            if (lvidd > 0 && lvids > 0) {
                const fs = ((lvidd - lvids) / lvidd) * 100;
                document.getElementById('fs').value = Math.round(fs);
            }
        }

        function calculateLAVolumeIndex() {
            const laVolume = parseFloat(document.getElementById('laVolume').value) || 0;
            const bsa = parseFloat(document.getElementById('bsa').value) || 1;
            
            if (laVolume > 0) {
                const laVolumeIndex = laVolume / bsa;
                document.getElementById('laVolumeIndex').value = Math.round(laVolumeIndex);
            }
            
            // Calculate RA Volume Index
            const raVolume = parseFloat(document.getElementById('raVolume').value) || 0;
            if (raVolume > 0) {
                const raVolumeIndex = raVolume / bsa;
                document.getElementById('raVolumeIndex').value = Math.round(raVolumeIndex);
            }
        }

        function calculateRAPressure() {
            const ivc = parseFloat(document.getElementById('ivc').value) || 0;
            const ivcCollapse = parseFloat(document.getElementById('ivcCollapse').value) || 0;
            
            let raPressure = 8; // Default
            
            if (ivc <= 21 && ivcCollapse > 50) {
                raPressure = 3;
            } else if (ivc <= 21 && ivcCollapse <= 50) {
                raPressure = 8;
            } else if (ivc > 21 && ivcCollapse > 50) {
                raPressure = 8;
            } else if (ivc > 21 && ivcCollapse <= 50) {
                raPressure = 15;
            }
            
            document.getElementById('raPressure').value = raPressure;
            calculatePASP();
        }

        function calculatePASP() {
            const rvsp = parseFloat(document.getElementById('rvsp').value) || 0;
            const raPressure = parseFloat(document.getElementById('raPressure').value) || 0;
            
            const pasp = rvsp + raPressure;
            document.getElementById('pasp').value = pasp;
            
            // Auto-determine pulmonary hypertension
            let pht = "None";
            if (pasp >= 36 && pasp <= 50) pht = "Mild";
            else if (pasp >= 51 && pasp <= 60) pht = "Moderate";
            else if (pasp > 60) pht = "Severe";
            
            document.getElementById('pht').value = pht;
        }

        function calculateDiastolic() {
            const eWave = parseFloat(document.getElementById('eWave').value) || 0;
            const aWave = parseFloat(document.getElementById('aWave').value) || 0;
            const ePrime = parseFloat(document.getElementById('ePrime').value) || 0;
            const ePrimeLat = parseFloat(document.getElementById('ePrimeLat').value) || 0;
            const sPulm = parseFloat(document.getElementById('sPulm').value) || 0;
            const dPulm = parseFloat(document.getElementById('dPulm').value) || 0;
            
            // Calculate E/A ratio
            if (eWave > 0 && aWave > 0) {
                const eaRatio = eWave / aWave;
                document.getElementById('eaRatio').value = eaRatio.toFixed(2);
            }
            
            // Calculate E' average
            if (ePrime > 0 && ePrimeLat > 0) {
                const ePrimeAvg = (ePrime + ePrimeLat) / 2;
                document.getElementById('ePrimeAvg').value = ePrimeAvg.toFixed(1);
                
                // Calculate E/E' ratio
                if (eWave > 0) {
                    const eePrime = (eWave * 100) / ePrimeAvg; // Convert e' to m/s
                    document.getElementById('eePrime').value = eePrime.toFixed(1);
                }
            }
            
            // Calculate S/D ratio
            if (sPulm > 0 && dPulm > 0) {
                const sdRatio = sPulm / dPulm;
                document.getElementById('sdRatio').value = sdRatio.toFixed(2);
            }
            
            // Determine diastolic dysfunction grade
            const eaRatio = parseFloat(document.getElementById('eaRatio').value) || 0;
            const eePrime = parseFloat(document.getElementById('eePrime').value) || 0;
            const laVolumeIndex = parseFloat(document.getElementById('laVolumeIndex').value) || 0;
            
            let grade = "Normal";
            
            // Simplified ASE 2016 algorithm
            if (ePrime < 7 || ePrimeLat < 10) {
                if (eaRatio < 0.8) {
                    grade = "Grade I (Impaired Relaxation)";
                } else if (eaRatio >= 0.8 && eaRatio <= 2.0) {
                    if (eePrime > 14 || laVolumeIndex > 34) {
                        grade = "Grade II (Pseudonormal)";
                    } else {
                        grade = "Grade I (Impaired Relaxation)";
                    }
                } else if (eaRatio > 2.0) {
                    grade = "Grade III (Restrictive)";
                }
            }
            
            document.getElementById('diastolicGrade').value = grade;
        }

        function calculateHemodynamics() {
            const lvotDiameter = parseFloat(document.getElementById('lvotDiameter').value) || 0;
            const lvotVti = parseFloat(document.getElementById('lvotVti').value) || 0;
            const hr = parseFloat(document.getElementById('hr').value) || 0;
            const bsa = parseFloat(document.getElementById('bsa').value) || 1;
            const svr = parseFloat(document.getElementById('svr').value) || 0;
            
            if (lvotDiameter > 0) {
                // Calculate LVOT area (œÄ √ó r¬≤)
                const lvotArea = Math.PI * Math.pow(lvotDiameter / 2 / 10, 2); // Convert mm to cm
                document.getElementById('lvotArea').value = lvotArea.toFixed(2);
                
                if (lvotVti > 0) {
                    // Calculate Stroke Volume (VTI √ó Area)
                    const strokeVolume = lvotVti * lvotArea;
                    document.getElementById('strokeVolume').value = Math.roun(strokeVolume);
                    
                    if (hr > 0) {
                        // Calculate Cardiac Output (SV √ó HR)
                        const cardiacOutput = (strokeVolume * hr) / 1000; // Convert to L/min
                        document.getElementById('cardiacOutput').value = cardiacOutput.toFixed(1);
                        
                        // Calculate Cardiac Index (CO / BSA)
                        const cardiacIndex = cardiacOutput / bsa;
                        document.getElementById('cardiacIndex').value = cardiacIndex.toFixed(1);
                    }
                }
            }
            
            // Calculate SVRI
            if (svr > 0) {
                const svri = svr * bsa;
                document.getElementById('svri').value = Math.round(svri);
            }
        }

        function calculateAVGradients() {
            const avMaxVel = parseFloat(document.getElementById('avMaxVel').value) || 0;
            
            if (avMaxVel > 0) {
                const avMaxGrad = 4 * Math.pow(avMaxVel, 2);
                const avMeanGrad = avMaxGrad * 0.6; // Approximation
                
                document.getElementById('avMaxGrad').value = Math.round(avMaxGrad);
                document.getElementById('avMeanGrad').value = Math.round(avMeanGrad);
            }
        }

        function calculateTVGradient() {
            const tvMaxVel = parseFloat(document.getElementById('tvMaxVel').value) || 0;
            
            if (tvMaxVel > 0) {
                const tvMaxGrad = 4 * Math.pow(tvMaxVel, 2);
                document.getElementById('tvMaxGrad').value = Math.round(tvMaxGrad);
                
                // Update RVSP
                document.getElementById('rvsp').value = Math.round(tvMaxGrad);
                calculatePASP();
            }
        }

        function calculateWilkinsScore() {
            const mobility = parseInt(document.getElementById('wilkinsMobility').value) || 0;
            const thickness = parseInt(document.getElementById('wilkinsThickness').value) || 0;
            const calc = parseInt(document.getElementById('wilkinsCalc').value) || 0;
            const subval = parseInt(document.getElementById('wilkinsSubval').value) || 0;
            
            const total = mobility + thickness + calc + subval;
            document.getElementById('wilkinsTotal').value = total;
        }

        function calculateWMSI() {
            const segments = [
                'basalAnterior', 'basalAnteroseptal', 'basalInferoseptal', 'basalInferior', 'basalInferolateral', 'basalAnterolateral',
                'midAnterior', 'midAnteroseptal', 'midInferoseptal', 'midInferior', 'midInferolateral', 'midAnterolateral',
                'apicalAnterior', 'apicalSeptal', 'apicalInferior', 'apicalLateral', 'apex'
            ];
            
            let totalScore = 0;
            let segmentCount = 0;
            
            segments.forEach(segment => {
                const value = document.getElementById(segment).value;
                let score = 1; // Normal
                
                switch(value) {
                    case 'Normal': score = 1; break;
                    case 'Hypokinetic': score = 2; break;
                    case 'Akinetic': score = 3; break;
                    case 'Dyskinetic': score = 4; break;
                    case 'Aneurysmal': score = 4; break;
                }
                
                totalScore += score;
                segmentCount++;
            });
            
            const wmsi = totalScore / segmentCount;
            document.getElementById('wmsi').value = wmsi.toFixed(1);
        }

        // Auto-interpretation engine
        function autoInterpret() {
            const lvef = parseFloat(document.getElementById('lvef').value) || 0;
            const lvidd = parseFloat(document.getElementById('lvidd').value) || 0;
            const lvmassIndex = parseFloat(document.getElementById('lvmassIndex').value) || 0;
            const laVolumeIndex = parseFloat(document.getElementById('laVolumeIndex').value) || 0;
            const tapse = parseFloat(document.getElementById('tapse').value) || 0;
            const pasp = parseFloat(document.getElementById('pasp').value) || 0;
            const diastolicGrade = document.getElementById('diastolicGrade').value;
            const gender = document.getElementById('gender').value;
            
            // Auto-check findings based on measurements
            const normalLVIDd = gender === 'Male' ? 59 : 53;
            const normalMassIndex = gender === 'Male' ? 102 : 88;
            
            document.getElementById('chk-lv-dilated').checked = (lvef < 50 || lvidd > normalLVIDd);
            document.getElementById('chk-lv-hypertrophy').checked = (lvmassIndex > normalMassIndex);
            document.getElementById('chk-rv-dysfunction').checked = (tapse < 17);
            document.getElementById('chk-la-dilated').checked = (laVolumeIndex > 34);
            document.getElementById('chk-diastolic-dys').checked = (diastolicGrade.includes("Grade"));
            document.getElementById('chk-pulm-htn').checked = (pasp > 40);
            
            // Check valve disease
            const arSeverity = document.getElementById('arSeverity').value;
            const mrSeverity = document.getElementById('mrSeverity').value;
            const trSeverity = document.getElementById('trSeverity').value;
            const avStenosis = document.getElementById('avStenosis').value;
            
            const significantValveDisease = 
                ['Moderate', 'Severe'].includes(arSeverity) ||
                ['Moderate', 'Severe'].includes(mrSeverity) ||
                ['Moderate', 'Severe'].includes(trSeverity) ||
                ['Moderate', 'Severe', 'Critical'].includes(avStenosis);
            
            document.getElementById('chk-valve-disease').checked = significantValveDisease;
            
            // Check wall motion
            const wmsi = parseFloat(document.getElementById('wmsi').value) || 1;
            document.getElementById('chk-wall-motion').checked = (wmsi > 1.0);
            
            // Check pericardial
            const pericardialEffusion = document.getElementById('pericardialEffusion').value;
            document.getElementById('chk-pericardial').checked = (pericardialEffusion !== 'None');
            
            // Generate clinical recommendations
            let recommendations = [];
            
            if (lvef < 40) {
                recommendations.push("Severely reduced LVEF - consider ACE inhibitor/ARB, beta-blocker, and cardiology follow-up");
                document.getElementById('reportUrgency').value = 'Urgent';
            }
            
            if (pasp > 60) {
                recommendations.push("Severe pulmonary hypertension - consider right heart catheterization and pulmonary hypertension evaluation");
            }
            
            if (significantValveDisease) {
                recommendations.push("Significant valve disease - consider cardiothoracic surgery consultation");
            }
            
            if (wmsi > 1.5) {
                recommendations.push("Significant wall motion abnormalities - consider stress testing or coronary angiography");
            }
            
            if (recommendations.length > 0) {
                document.getElementById('clinicalCorrelation').value = recommendations.join('. ');
            }
            
            showNotification('Auto-interpretation completed successfully!', 'success');
        }

        // Template loading
        function loadTemplate(type) {
            switch(type) {
                case 'normal':
                    document.getElementById('lvef').value = 65;
                    document.getElementById('lvidd').value = 48;
                    document.getElementById('lvids').value = 30;
                    document.getElementById('tapse').value = 22;
                    document.getElementById('pasp').value = 28;
                    break;
                case 'abnormal':
                    document.getElementById('lvef').value = 35;
                    document.getElementById('lvidd').value = 62;
                    document.getElementById('lvids').value = 52;
                    document.getElementById('tapse').value = 15;
                    document.getElementById('pasp').value = 55;
                    break;
                case 'emergency':
                    document.getElementById('lvef').value = 20;
                    document.getElementById('lvidd').value = 70;
                    document.getElementById('reportUrgency').value = 'STAT';
                    break;
            }
            
            // Recalculate all dependent values
            calculateBSA();
            calculateLVMass();
            calculateFS();
            calculateDiastolic();
            calculateHemodynamics();
            calculatePASP();
            
            showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} template loaded`, 'info');
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type}`;
            notification.style.position = 'fixed';
            notification.style.top = '90px';
            notification.style.right = '20px';
            notification.style.zIndex = '1001';
            notification.style.minWidth = '300px';
            notification.innerHTML = `
                <strong>${type.charAt(0).toUpperCase() + type.slice(1)}:</strong> ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 18px; cursor: pointer;">&times;</button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Form reset
        function resetForm() {
            if (confirm('Are you sure you want to reset all form data?')) {
                document.getElementById('report-form').reset();
                
                // Reset to default values
                document.getElementById('patientName').value = 'Mohamed Saleck Sid Ahmed';
                document.getElementById('patientId').value = '380869';
                document.getElementById('examDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('performingPhysician').value = 'Dr. Ghiath Backdach';
                
                // Recalculate all values
                calculateBSA();
                calculateLVMass();
                calculateDiastolic();
                calculateHemodynamics();
                calculatePASP();
                
                document.getElementById('report-output').innerHTML = `
                    <div class="placeholder-text">
                        <div class="placeholder-icon">ü´Ä</div>
                        <div>Form reset successfully</div>
                        <div style="font-size: 1rem; margin-top: 0.5rem; color: var(--text-secondary);">
                            Fill out the form and click "Generate Report"
                        </div>
                    </div>
                `;
                
                showNotification('Form reset successfully', 'success');
            }
        }

        // Utility functions
        function formatMeasurement(value, min, max, unit, gender = 'Male') {
            if (isNaN(value) || value === 0) return 'N/A';
            
            let formattedValue = `${value} ${unit}`;
            let status = '';
            let statusClass = '';
            
            // Adjust normal ranges based on gender if applicable
            if (gender === 'Female' && min !== null && max !== null) {
                // Apply gender-specific adjustments for certain parameters
                // This is a simplified approach - in practice, you'd have comprehensive gender-specific ranges
            }
            
            if (min !== null && value < min) {
                status = ' ‚ñº';
                statusClass = 'highlight-red';
            } else if (max !== null && value > max) {
                status = ' ‚ñ≤';
                statusClass = 'highlight-red';
            } else {
                statusClass = 'highlight-green';
            }
            
            return `<span class="${statusClass}"><strong>${formattedValue}${status}</strong></span>`;
        }

        function getStatusIndicator(value, min, max, unit) {
            if (isNaN(value) || value === 0) return '<span class="status-indicator">‚ùì N/A</span>';
            
            if ((min !== null && value < min) || (max !== null && value > max)) {
                return '<span class="status-indicator status-abnormal">‚ö†Ô∏è Abnormal</span>';
            } else {
                return '<span class="status-indicator status-normal">‚úÖ Normal</span>';
            }
        }

        function getSeverityBadge(severity) {
            const severityClass = `severity-${severity.toLowerCase()}`;
            return `<span class="severity-badge ${severityClass}">${severity}</span>`;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric' 
            });
        }

        function formatTime(timeString) {
            if (!timeString) return 'N/A';
            return timeString;
        }

        function getMedicalHistory() {
            const conditions = [];
            const checkboxes = ['htn', 'dm', 'cad', 'ckd', 'af', 'hf', 'copd', 'stroke', 'smoking', 'familyHx'];
            const labels = ['HTN', 'DM', 'CAD', 'CKD', 'AF', 'HF', 'COPD', 'Stroke/TIA', 'Smoking', 'Family Hx CAD'];
            
            checkboxes.forEach((id, index) => {
                if (document.getElementById(id).checked) {
                    conditions.push(labels[index]);
                }
            });
            
            return conditions.length > 0 ? conditions.join(', ') : 'None documented';
        }

        function getCongenitalAbnormalities() {
            const abnormalities = [];
            const checkboxes = ['asd', 'vsd', 'pda', 'pfo', 'coarctation', 'bicuspidAV'];
            const labels = ['ASD', 'VSD', 'PDA', 'PFO', 'Coarctation', 'Bicuspid AV'];
            
            checkboxes.forEach((id, index) => {
                if (document.getElementById(id).checked) {
                    abnormalities.push(labels[index]);
                }
            });
            
            return abnormalities.length > 0 ? abnormalities.join(', ') : 'None';
        }

        function getWallMotionFindings() {
            const segments = [
                { id: 'basalAnterior', name: 'Basal Anterior' },
                { id: 'basalAnteroseptal', name: 'Basal Anteroseptal' },
                { id: 'basalInferoseptal', name: 'Basal Inferoseptal' },
                { id: 'basalInferior', name: 'Basal Inferior' },
                { id: 'basalInferolateral', name: 'Basal Inferolateral' },
                { id: 'basalAnterolateral', name: 'Basal Anterolateral' },
                { id: 'midAnterior', name: 'Mid Anterior' },
                { id: 'midAnteroseptal', name: 'Mid Anteroseptal' },
                { id: 'midInferoseptal', name: 'Mid Inferoseptal' },
                { id: 'midInferior', name: 'Mid Inferior' },
                { id: 'midInferolateral', name: 'Mid Inferolateral' },
                { id: 'midAnterolateral', name: 'Mid Anterolateral' },
                { id: 'apicalAnterior', name: 'Apical Anterior' },
                { id: 'apicalSeptal', name: 'Apical Septal' },
                { id: 'apicalInferior', name: 'Apical Inferior' },
                { id: 'apicalLateral', name: 'Apical Lateral' },
                { id: 'apex', name: 'Apex' }
            ];
            
            const abnormal = [];
            
            segments.forEach(segment => {
                const value = document.getElementById(segment.id).value;
                if (value !== 'Normal') {
                    abnormal.push(`${segment.name}: ${value.toLowerCase()}`);
                }
            });
            
            return abnormal.length > 0 ? abnormal.join('; ') : null;
        }

        // Main report generation function
        function generateReport() {
            showNotification('Generating comprehensive report...', 'info');
            
            // Get all form data
            const data = {
                // Patient demographics
                patientName: document.getElementById('patientName').value || 'N/A',
                patientId: document.getElementById('patientId').value || 'N/A',
                age: document.getElementById('age').value || 'N/A',
                gender: document.getElementById('gender').value || 'N/A',
                height: document.getElementById('height').value || 'N/A',
                weight: document.getElementById('weight').value || 'N/A',
                bsa: parseFloat(document.getElementById('bsa').value) || 0,
                bmi: parseFloat(document.getElementById('bmi').value) || 0,
                examDate: formatDate(document.getElementById('examDate').value),
                examTime: formatTime(document.getElementById('examTime').value),
                referringPhysician: document.getElementById('referringPhysician').value || 'N/A',
                performingPhysician: document.getElementById('performingPhysician').value || 'N/A',
                reasonForExam: document.getElementById('reasonForExam').value || 'N/A',
                hr: document.getElementById('hr').value || 'N/A',
                bp: document.getElementById('bp').value || 'N/A',
                o2Sat: document.getElementById('o2Sat').value || 'N/A',
                studyQuality: document.getElementById('studyQuality').value || 'N/A',
                clinicalHistory: document.getElementById('clinicalHistory').value || 'None documented',
                medicalHistory: getMedicalHistory(),
                medications: document.getElementById('medications').value || 'None documented',
                
                // Measurements
                lvef: parseFloat(document.getElementById('lvef').value) || 0,
                lvefMethod: document.getElementById('lvefMethod').value || 'N/A',
                lvidd: parseFloat(document.getElementById('lvidd').value) || 0,
                lvids: parseFloat(document.getElementById('lvids').value) || 0,
                fs: parseFloat(document.getElementById('fs').value) || 0,
                ivsd: parseFloat(document.getElementById('ivsd').value) || 0,
                lvpwd: parseFloat(document.getElementById('lvpwd').value) || 0,
                lvmass: parseFloat(document.getElementById('lvmass').value) || 0,
                lvmassIndex: parseFloat(document.getElementById('lvmassIndex').value) || 0,
                rwt: parseFloat(document.getElementById('rwt').value) || 0,
                lvGeometry: document.getElementById('lvGeometry').value || 'N/A',
                gls: parseFloat(document.getElementById('gls').value) || 0,
                
                // Left atrium
                laArea: parseFloat(document.getElementById('laArea').value) || 0,
                laVolume: parseFloat(document.getElementById('laVolume').value) || 0,
                laVolumeIndex: parseFloat(document.getElementById('laVolumeIndex').value) || 0,
                laDiameter: parseFloat(document.getElementById('laDiameter').value) || 0,
                
                // Aorta
                aorticRoot: parseFloat(document.getElementById('aorticRoot').value) || 0,
                ascAorta: parseFloat(document.getElementById('ascAorta').value) || 0,
                aorticArch: parseFloat(document.getElementById('aorticArch').value) || 0,
                sov: parseFloat(document.getElementById('sov').value) || 0,
                stj: parseFloat(document.getElementById('stj').value) || 0,
                
                // Right heart
                rvot: parseFloat(document.getElementById('rvot').value) || 0,
                rvedd: parseFloat(document.getElementById('rvedd').value) || 0,
                rvLength: parseFloat(document.getElementById('rvLength').value) || 0,
                tapse: parseFloat(document.getElementById('tapse').value) || 0,
                rvFac: parseFloat(document.getElementById('rvFac').value) || 0,
                sPrime: parseFloat(document.getElementById('sPrime').value) || 0,
                rvsp: parseFloat(document.getElementById('rvsp').value) || 0,
                rvFunction: document.getElementById('rvFunction').value || 'N/A',
                raArea: parseFloat(document.getElementById('raArea').value) || 0,
                raVolume: parseFloat(document.getElementById('raVolume').value) || 0,
                raVolumeIndex: parseFloat(document.getElementById('raVolumeIndex').value) || 0,
                ivc: parseFloat(document.getElementById('ivc').value) || 0,
                ivcCollapse: parseFloat(document.getElementById('ivcCollapse').value) || 0,
                raPressure: parseFloat(document.getElementById('raPressure').value) || 0,
                pasp: parseFloat(document.getElementById('pasp').value) || 0,
                padp: parseFloat(document.getElementById('padp').value) || 0,
                pht: document.getElementById('pht').value || 'None',
                
                // Diastolic function
                eWave: parseFloat(document.getElementById('eWave').value) || 0,
                aWave: parseFloat(document.getElementById('aWave').value) || 0,
                eaRatio: parseFloat(document.getElementById('eaRatio').value) || 0,
                dt: parseFloat(document.getElementById('dt').value) || 0,
                ivrt: parseFloat(document.getElementById('ivrt').value) || 0,
                ePrime: parseFloat(document.getElementById('ePrime').value) || 0,
                ePrimeLat: parseFloat(document.getElementById('ePrimeLat').value) || 0,
                ePrimeAvg: parseFloat(document.getElementById('ePrimeAvg').value) || 0,
                eePrime: parseFloat(document.getElementById('eePrime').value) || 0,
                aPrimeSep: parseFloat(document.getElementById('aPrimeSep').value) || 0,
                aPrimeLat: parseFloat(document.getElementById('aPrimeLat').value) || 0,
                sPrimeSep: parseFloat(document.getElementById('sPrimeSep').value) || 0,
                sPrimeLat: parseFloat(document.getElementById('sPrimeLat').value) || 0,
                sPulm: parseFloat(document.getElementById('sPulm').value) || 0,
                dPulm: parseFloat(document.getElementById('dPulm').value) || 0,
                arDuration: parseFloat(document.getElementById('arDuration').value) || 0,
                sdRatio: parseFloat(document.getElementById('sdRatio').value) || 0,
                diastolicGrade: document.getElementById('diastolicGrade').value || 'Normal',
                fillingPressures: document.getElementById('fillingPressures').value || 'Normal',
                
                // Hemodynamics
                lvotDiameter: parseFloat(document.getElementById('lvotDiameter').value) || 0,
                lvotVti: parseFloat(document.getElementById('lvotVti').value) || 0,
                lvotArea: parseFloat(document.getElementById('lvotArea').value) || 0,
                strokeVolume: parseFloat(document.getElementById('strokeVolume').value) || 0,
                cardiacOutput: parseFloat(document.getElementById('cardiacOutput').value) || 0,
                cardiacIndex: parseFloat(document.getElementById('cardiacIndex').value) || 0,
                svr: parseFloat(document.getElementById('svr').value) || 0,
                svri: parseFloat(document.getElementById('svri').value) || 0,
                
                // Valves
                avMorphology: document.getElementById('avMorphology').value || 'N/A',
                avArea: parseFloat(document.getElementById('avArea').value) || 0,
                avMaxVel: parseFloat(document.getElementById('avMaxVel').value) || 0,
                avMeanGrad: parseFloat(document.getElementById('avMeanGrad').value) || 0,
                avMaxGrad: parseFloat(document.getElementById('avMaxGrad').value) || 0,
                avVti: parseFloat(document.getElementById('avVti').value) || 0,
                avStenosis: document.getElementById('avStenosis').value || 'None',
                arSeverity: document.getElementById('arSeverity').value || 'None',
                arJetWidth: parseFloat(document.getElementById('arJetWidth').value) || 0,
                arVc: parseFloat(document.getElementById('arVc').value) || 0,
                arRegVol: parseFloat(document.getElementById('arRegVol').value) || 0,
                arEroa: parseFloat(document.getElementById('arEroa').value) || 0,
                
                mvMorphology: document.getElementById('mvMorphology').value || 'N/A',
                mvArea: parseFloat(document.getElementById('mvArea').value) || 0,
                mvMeanGrad: parseFloat(document.getElementById('mvMeanGrad').value) || 0,
                mvHalfTime: parseFloat(document.getElementById('mvHalfTime').value) || 0,
                mvStenosis: document.getElementById('mvStenosis').value || 'None',
                mrSeverity: document.getElementById('mrSeverity').value || 'None',
                mrMechanism: document.getElementById('mrMechanism').value || 'None',
                mrJetArea: parseFloat(document.getElementById('mrJetArea').value) || 0,
                mrVc: parseFloat(document.getElementById('mrVc').value) || 0,
                mrPisa: parseFloat(document.getElementById('mrPisa').value) || 0,
                mrRegVol: parseFloat(document.getElementById('mrRegVol').value) || 0,
                mrEroa: parseFloat(document.getElementById('mrEroa').value) || 0,
                wilkinsTotal: parseFloat(document.getElementById('wilkinsTotal').value) || 0,
                
                tvMorphology: document.getElementById('tvMorphology').value || 'N/A',
                tvMaxVel: parseFloat(document.getElementById('tvMaxVel').value) || 0,
                tvMaxGrad: parseFloat(document.getElementById('tvMaxGrad').value) || 0,
                trSeverity: document.getElementById('trSeverity').value || 'None',
                trJetArea: parseFloat(document.getElementById('trJetArea').value) || 0,
                trVc: parseFloat(document.getElementById('trVc').value) || 0,
                trPisa: parseFloat(document.getElementById('trPisa').value) || 0,
                trRegVol: parseFloat(document.getElementById('trRegVol').value) || 0,
                trEroa: parseFloat(document.getElementById('trEroa').value) || 0,
                
                pvMorphology: document.getElementById('pvMorphology').value || 'N/A',
                pvMaxVel: parseFloat(document.getElementById('pvMaxVel').value) || 0,
                pvMaxGrad: parseFloat(document.getElementById('pvMaxGrad').value) || 0,
                psSeverity: document.getElementById('psSeverity').value || 'None',
                prSeverity: document.getElementById('prSeverity').value || 'None',
                prJetWidth: parseFloat(document.getElementById('prJetWidth').value) || 0,
                
                // Wall motion
                wmsi: parseFloat(document.getElementById('wmsi').value) || 1.0,
                coronaryTerritory: document.getElementById('coronaryTerritory').value || 'None',
                wallMotionFindings: getWallMotionFindings(),
                
                // Additional findings
                pericardialEffusion: document.getElementById('pericardialEffusion').value || 'None',
                tamponade: document.getElementById('tamponade').value || 'No',
                pericardialThickening: document.getElementById('pericardialThickening').value || 'No',
                laThrombus: document.getElementById('laThrombus').value || 'None',
                lvThrombus: document.getElementById('lvThrombus').value || 'None',
                vegetation: document.getElementById('vegetation').value || 'None',
                vegetationLocation: document.getElementById('vegetationLocation').value || 'None',
                prostheticAV: document.getElementById('prostheticAV').value || 'None',
                prostheticMV: document.getElementById('prostheticMV').value || 'None',
                prostheticFunction: document.getElementById('prostheticFunction').value || 'Normal',
                congenitalAbnormalities: getCongenitalAbnormalities(),
                additionalFindings: document.getElementById('additionalFindings').value || 'None',
                
                // Clinical correlation
                clinicalCorrelation: document.getElementById('clinicalCorrelation').value || 'None',
                reportUrgency: document.getElementById('reportUrgency').value || 'Routine'
            };

            // Format measurements with normal ranges
            const gender = data.gender;
            const measurements = {
                lvef: formatMeasurement(data.lvef, gender === 'Male' ? 53 : 55, 77, '%', gender),
                lvidd: formatMeasurement(data.lvidd, gender === 'Male' ? 42 : 39, gender === 'Male' ? 59 : 53, 'mm', gender),
                lvids: formatMeasurement(data.lvids, gender === 'Male' ? 25 : 22, gender === 'Male' ? 40 : 35, 'mm', gender),
                fs: formatMeasurement(data.fs, 27, 45, '%', gender),
                ivsd: formatMeasurement(data.ivsd, 6, gender === 'Male' ? 10 : 9, 'mm', gender),
                lvpwd: formatMeasurement(data.lvpwd, 6, gender === 'Male' ? 10 : 9, 'mm', gender),
                lvmassIndex: formatMeasurement(data.lvmassIndex, gender === 'Male' ? 50 : 44, gender === 'Male' ? 102 : 88, 'g/m¬≤', gender),
                rwt: formatMeasurement(data.rwt, null, 0.42, '', gender),
                gls: formatMeasurement(Math.abs(data.gls), 18, null, '%', gender),
                
                laArea: formatMeasurement(data.laArea, null, 20, 'cm¬≤', gender),
                laVolumeIndex: formatMeasurement(data.laVolumeIndex, null, 34, 'ml/m¬≤', gender),
                laDiameter: formatMeasurement(data.laDiameter, null, 40, 'mm', gender),
                
                aorticRoot: formatMeasurement(data.aorticRoot, 20, 37, 'mm', gender),
                ascAorta: formatMeasurement(data.ascAorta, 19, 35, 'mm', gender),
                
                tapse: formatMeasurement(data.tapse, 17, null, 'mm', gender),
                rvFac: formatMeasurement(data.rvFac, 35, null, '%', gender),
                sPrime: formatMeasurement(data.sPrime, 9.5, null, 'cm/s', gender),
                pasp: formatMeasurement(data.pasp, null, 40, 'mmHg', gender),
                raArea: formatMeasurement(data.raArea, null, 18, 'cm¬≤', gender),
                ivc: formatMeasurement(data.ivc, 15, 25, 'mm', gender),
                
                eaRatio: formatMeasurement(data.eaRatio, 0.8, 2.0, '', gender),
                eePrime: formatMeasurement(data.eePrime, null, 14, '', gender),
                ePrime: formatMeasurement(data.ePrime, 7, null, 'cm/s', gender),
                ePrimeLat: formatMeasurement(data.ePrimeLat, 10, null, 'cm/s', gender),
                dt: formatMeasurement(data.dt, 160, 240, 'ms', gender),
                ivrt: formatMeasurement(data.ivrt, 70, 100, 'ms', gender),
                
                cardiacIndex: formatMeasurement(data.cardiacIndex, 2.5, 4.0, 'L/min/m¬≤', gender),
                
                avArea: formatMeasurement(data.avArea, 2.0, null, 'cm¬≤', gender),
                mvArea: formatMeasurement(data.mvArea, 2.5, null, 'cm¬≤', gender),
                
                wmsi: formatMeasurement(data.wmsi, null, 1.0, '', gender)
            };

            // Generate status indicators
            const statusIndicators = {
                lvef: getStatusIndicator(data.lvef, gender === 'Male' ? 53 : 55, 77),
                lvidd: getStatusIndicator(data.lvidd, gender === 'Male' ? 42 : 39, gender === 'Male' ? 59 : 53),
                lvmassIndex: getStatusIndicator(data.lvmassIndex, gender === 'Male' ? 50 : 44, gender === 'Male' ? 102 : 88),
                laVolumeIndex: getStatusIndicator(data.laVolumeIndex, null, 34),
                tapse: getStatusIndicator(data.tapse, 17, null),
                pasp: getStatusIndicator(data.pasp, null, 40),
                eePrime: getStatusIndicator(data.eePrime, null, 14),
                cardiacIndex: getStatusIndicator(data.cardiacIndex, 2.5, 4.0)
            };

            // Generate conclusion items based on checked findings
            let conclusionItems = '';
            
            if (document.getElementById('chk-lv-dilated').checked) {
                const severity = data.lvef < 30 ? 'severely' : data.lvef < 40 ? 'moderately' : 'mildly';
                conclusionItems += `<li><strong>Left Ventricular Function:</strong> The left ventricle is dilated with ${severity} reduced systolic function (LVEF: ${measurements.lvef} by ${data.lvefMethod}). ${data.lvGeometry} pattern is present.</li>`;
            } else if (data.lvef >= 50) {
                conclusionItems += `<li><strong>Left Ventricular Function:</strong> Normal left ventricular size and systolic function (LVEF: ${measurements.lvef} by ${data.lvefMethod}).</li>`;
            }
            
            if (document.getElementById('chk-lv-hypertrophy').checked) {
                conclusionItems += `<li><strong>Left Ventricular Hypertrophy:</strong> Evidence of left ventricular hypertrophy (LV Mass Index: ${measurements.lvmassIndex}) with ${data.lvGeometry.toLowerCase()} pattern.</li>`;
            }
            
            if (document.getElementById('chk-rv-dysfunction').checked) {
                conclusionItems += `<li><strong>Right Ventricular Function:</strong> ${data.rvFunction.toLowerCase()} right ventricular systolic function (TAPSE: ${measurements.tapse}, RV FAC: ${measurements.rvFac}%, RV S': ${measurements.sPrime}).</li>`;
            } else {
                conclusionItems += `<li><strong>Right Ventricular Function:</strong> Normal right ventricular size and systolic function.</li>`;
            }
            
            if (document.getElementById('chk-la-dilated').checked) {
                conclusionItems += `<li><strong>Left Atrium:</strong> The left atrium is dilated (Area: ${measurements.laArea}, Volume Index: ${measurements.laVolumeIndex}). ${data.laThrombus !== 'None' ? `Evidence of ${data.laThrombus.toLowerCase()}.` : 'No thrombus or spontaneous echo contrast identified.'}</li>`;
            }
            
            if (document.getElementById('chk-ra-dilated').checked) {
                conclusionItems += `<li><strong>Right Atrium:</strong> The right atrium is dilated (Area: ${measurements.raArea}).</li>`;
            }
            
            if (document.getElementById('chk-diastolic-dys').checked) {
                conclusionItems += `<li><strong>Diastolic Function:</strong> ${data.diastolicGrade} (E/A: ${measurements.eaRatio}, E/E': ${measurements.eePrime}, DT: ${measurements.dt}, IVRT: ${measurements.ivrt}). LV filling pressures appear ${data.fillingPressures.toLowerCase()}.</li>`;
            } else {
                conclusionItems += `<li><strong>Diastolic Function:</strong> Normal diastolic function parameters.</li>`;
            }
            
            if (document.getElementById('chk-valve-disease').checked) {
                let valveFindings = [];
                if (data.avStenosis !== 'None') valveFindings.push(`${data.avStenosis.toLowerCase()} aortic stenosis`);
                if (data.arSeverity !== 'None' && data.arSeverity !== 'Trace') valveFindings.push(`${data.arSeverity.toLowerCase()} aortic regurgitation`);
                if (data.mvStenosis !== 'None') valveFindings.push(`${data.mvStenosis.toLowerCase()} mitral stenosis`);
                if (data.mrSeverity !== 'None' && data.mrSeverity !== 'Trace') valveFindings.push(`${data.mrSeverity.toLowerCase()} mitral regurgitation`);
                if (data.trSeverity !== 'None' && data.trSeverity !== 'Trace') valveFindings.push(`${data.trSeverity.toLowerCase()} tricuspid regurgitation`);
                if (data.prSeverity !== 'None' && data.prSeverity !== 'Trace') valveFindings.push(`${data.prSeverity.toLowerCase()} pulmonary regurgitation`);
                
                if (valveFindings.length > 0) {
                    conclusionItems += `<li><strong>Valvular Disease:</strong> ${valveFindings.join(', ')}.</li>`;
                }
            } else {
                conclusionItems += `<li><strong>Valves:</strong> No significant valvular stenosis or regurgitation. Trace regurgitation of aortic, mitral, and tricuspid valves is physiologic.</li>`;
            }
            
            if (document.getElementById('chk-pulm-htn').checked) {
                const severity = data.pasp > 60 ? 'severe' : data.pasp > 50 ? 'moderate' : 'mild';
                conclusionItems += `<li><strong>Pulmonary Hypertension:</strong> Evidence of ${severity} pulmonary hypertension (PASP: ${measurements.pasp}). ${data.pht !== 'None' ? `Classified as ${data.pht.toLowerCase()} pulmonary hypertension.` : ''}</li>`;
            }
            
            if (document.getElementById('chk-wall-motion').checked && data.wallMotionFindings) {
                conclusionItems += `<li><strong>Regional Wall Motion:</strong> ${data.wallMotionFindings} (WMSI: ${measurements.wmsi}). ${data.coronaryTerritory !== 'None' ? `Findings suggest ${data.coronaryTerritory} territory involvement.` : ''}</li>`;
            } else {
                conclusionItems += `<li><strong>Regional Wall Motion:</strong> Normal regional wall motion in all segments.</li>`;
            }
            
            if (document.getElementById('chk-pericardial').checked) {
                let pericardialFindings = [];
                if (data.pericardialEffusion !== 'None') pericardialFindings.push(`${data.pericardialEffusion.toLowerCase()} pericardial effusion`);
                if (data.tamponade !== 'No') pericardialFindings.push(`${data.tamponade.toLowerCase()} tamponade physiology`);
                if (data.pericardialThickening === 'Yes') pericardialFindings.push('pericardial thickening');
                
                if (pericardialFindings.length > 0) {
                    conclusionItems += `<li><strong>Pericardium:</strong> ${pericardialFindings.join(', ')}.</li>`;
                }
            } else {
                conclusionItems += `<li><strong>Pericardium:</strong> No pericardial effusion or thickening.</li>`;
            }
            
            // Add hemodynamic assessment
            conclusionItems += `<li><strong>Hemodynamics:</strong> Stroke volume: ${data.strokeVolume} ml, Cardiac output: ${data.cardiacOutput} L/min, Cardiac index: ${measurements.cardiacIndex}.</li>`;
            
            // Add strain assessment if available
            if (data.gls !== 0) {
                const strainStatus = Math.abs(data.gls) < 18 ? 'reduced' : 'normal';
                conclusionItems += `<li><strong>Strain Assessment:</strong> Global longitudinal strain is ${strainStatus} (${data.gls}%).</li>`;
            }
            
            // Add additional findings
            if (data.additionalFindings !== 'None' && data.additionalFindings.trim() !== '') {
                conclusionItems += `<li><strong>Additional Findings:</strong> ${data.additionalFindings}</li>`;
            }
            
            // Add congenital abnormalities
            if (data.congenitalAbnormalities !== 'None') {
                conclusionItems += `<li><strong>Congenital Abnormalities:</strong> ${data.congenitalAbnormalities}.</li>`;
            }
            
            // Add clinical correlation
            if (data.clinicalCorrelation !== 'None' && data.clinicalCorrelation.trim() !== '') {
                conclusionItems += `<li><strong>Clinical Correlation:</strong> ${data.clinicalCorrelation}</li>`;
            }

            // Generate alerts based on findings
            let alerts = '';
            
            if (data.lvef < 30) {
                alerts += `<div class="alert alert-danger">
                    <strong>üö® Critical Alert:</strong> Severely reduced left ventricular function (LVEF: ${data.lvef}%). Urgent cardiology consultation recommended.
                </div>`;
            } else if (data.lvef < 40) {
                alerts += `<div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Clinical Alert:</strong> Moderately reduced left ventricular function (LVEF: ${data.lvef}%). Consider ACE inhibitor/ARB and beta-blocker therapy.
                </div>`;
            }
            
            if (data.pasp > 60) {
                alerts += `<div class="alert alert-danger">
                    <strong>üö® Critical Alert:</strong> Severe pulmonary hypertension (PASP: ${data.pasp} mmHg). Consider right heart catheterization and pulmonary hypertension evaluation.
                </div>`;
            } else if (data.pasp > 50) {
                alerts += `<div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Clinical Alert:</strong> Moderate pulmonary hypertension detected. Further evaluation may be warranted.
                </div>`;
            }
            
            if (data.eePrime > 15) {
                alerts += `<div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Clinical Note:</strong> Elevated E/E' ratio (${data.eePrime}) suggests increased LV filling pressures.
                </div>`;
            }
            
            if (data.wmsi > 1.5) {
                alerts += `<div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Clinical Alert:</strong> Significant wall motion abnormalities (WMSI: ${data.wmsi}). Consider stress testing or coronary angiography.
                </div>`;
            }
            
            if (['Moderate', 'Severe', 'Critical'].includes(data.avStenosis) || 
                ['Moderate', 'Severe'].includes(data.arSeverity) ||
                ['Moderate', 'Severe'].includes(data.mrSeverity)) {
                alerts += `<div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Clinical Alert:</strong> Significant valve disease detected. Consider cardiothoracic surgery consultation.
                </div>`;
            }
            
            if (data.vegetation === 'Present') {
                alerts += `<div class="alert alert-danger">
                    <strong>üö® Critical Alert:</strong> Vegetation identified on ${data.vegetationLocation}. Urgent infectious disease and cardiology consultation recommended.
                </div>`;
            }
            
            if (data.tamponade === 'Present') {
                alerts += `<div class="alert alert-danger">
                    <strong>üö® Emergency Alert:</strong> Cardiac tamponade physiology present. Immediate pericardiocentesis may be required.
                </div>`;
            }

            // Generate the comprehensive report HTML
            const reportHTML = `
                <div class="report-container-inner">
                    <header class="report-header">
                        <div class="hospital-logo">üè•</div>
                        <div class="hospital-name">Centre National de Cardiologie - Nouakchott</div>
                        <h1 class="report-title">Comprehensive Echocardiography Report</h1>
                        <div class="report-subtitle">Advanced Doppler & Strain Assessment</div>
                    </header>

                    ${alerts}

                    <section class="report-section">
                        <h3><span class="section-icon-report">üë§</span>Patient Demographics & Clinical Information</h3>
                        <div class="details-grid">
                            <div class="patient-card">
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Patient Details</h4>
                                <table>
                                    <tbody>
                                        <tr><td><strong>Name:</strong></td><td>${data.patientName}</td></tr>
                                        <tr><td><strong>ID:</strong></td><td>${data.patientId}</td></tr>
                                        <tr><td><strong>Age/Gender:</strong></td><td>${data.age} years, ${data.gender}</td></tr>
                                        <tr><td><strong>Height/Weight:</strong></td><td>${data.height} cm, ${data.weight} kg</td></tr>
                                        <tr><td><strong>BSA/BMI:</strong></td><td>${data.bsa} m¬≤, ${data.bmi} kg/m¬≤</td></tr>
                                        <tr><td><strong>Vital Signs:</strong></td><td>HR: ${data.hr} bpm, BP: ${data.bp} mmHg, O2 Sat: ${data.o2Sat}%</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="patient-card">
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Examination Details</h4>
                                <table>
                                    <tbody>
                                        <tr><td><strong>Date/Time:</strong></td><td>${data.examDate}, ${data.examTime}</td></tr>
                                        <tr><td><strong>Referring Physician:</strong></td><td>${data.referringPhysician}</td></tr>
                                        <tr><td><strong>Performing Physician:</strong></td><td>${data.performingPhysician}</td></tr>
                                        <tr><td><strong>Indication:</strong></td><td>${data.reasonForExam}</td></tr>
                                        <tr><td><strong>Study Quality:</strong></td><td>${data.studyQuality}</td></tr>
                                        <tr><td><strong>Report Urgency:</strong></td><td><span class="severity-badge severity-${data.reportUrgency.toLowerCase()}">${data.reportUrgency}</span></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div style="margin-top: 1rem;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Clinical History</h4>
                            <p><strong>History:</strong> ${data.clinicalHistory}</p>
                            <p><strong>Medical History:</strong> ${data.medicalHistory}</p>
                            <p><strong>Medications:</strong> ${data.medications}</p>
                        </div>
                    </section>

                    <section class="report-section">
                        <h3><span class="section-icon-report">‚ù§Ô∏è</span>Left Heart Structure & Function</h3>
                        
                        <div class="measurement-cards">
                            <div class="measurement-card">
                                <div class="measurement-value">${data.lvef}%</div>
                                <div class="measurement-label">LVEF (${data.lvefMethod})</div>
                                <div class="measurement-range">Normal: ‚â•${data.gender === 'Male' ? '53' : '55'}%</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.lvmassIndex}</div>
                                <div class="measurement-label">LV Mass Index</div>
                                <div class="measurement-range">Normal: ${data.gender === 'Male' ? '50-102' : '44-88'} g/m¬≤</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.laVolumeIndex}</div>
                                <div class="measurement-label">LA Volume Index</div>
                                <div class="measurement-range">Normal: ‚â§34 ml/m¬≤</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${Math.abs(data.gls)}%</div>
                                <div class="measurement-label">Global Longitudinal Strain</div>
                                <div class="measurement-range">Normal: ‚â•18%</div>
                            </div>
                        </div>

                        <table>
                            <thead>
                                <tr><th>Parameter</th><th>Value</th><th>Normal Range</th><th>Status</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>LVEF (${data.lvefMethod})</td><td>${measurements.lvef}</td><td>‚â•${data.gender === 'Male' ? '53' : '55'}%</td><td>${statusIndicators.lvef}</td></tr>
                                <tr><td>LVIDd</td><td>${measurements.lvidd}</td><td>${data.gender === 'Male' ? '42-59' : '39-53'} mm</td><td>${statusIndicators.lvidd}</td></tr>
                                <tr><td>LVIDs</td><td>${measurements.lvids}</td><td>${data.gender === 'Male' ? '25-40' : '22-35'} mm</td><td>${getStatusIndicator(data.lvids, data.gender === 'Male' ? 25 : 22, data.gender === 'Male' ? 40 : 35)}</td></tr>
                                <tr><td>Fractional Shortening</td><td>${measurements.fs}</td><td>27-45%</td><td>${getStatusIndicator(data.fs, 27, 45)}</td></tr>
                                <tr><td>IVSd</td><td>${measurements.ivsd}</td><td>6-${data.gender === 'Male' ? '10' : '9'} mm</td><td>${getStatusIndicator(data.ivsd, 6, data.gender === 'Male' ? 10 : 9)}</td></tr>
                                <tr><td>LVPWd</td><td>${measurements.lvpwd}</td><td>6-${data.gender === 'Male' ? '10' : '9'} mm</td><td>${getStatusIndicator(data.lvpwd, 6, data.gender === 'Male' ? 10 : 9)}</td></tr>
                                <tr><td>LV Mass Index</td><td>${measurements.lvmassIndex}</td><td>${data.gender === 'Male' ? '50-102' : '44-88'} g/m¬≤</td><td>${statusIndicators.lvmassIndex}</td></tr>
                                <tr><td>Relative Wall Thickness</td><td>${measurements.rwt}</td><td>‚â§0.42</td><td>${getStatusIndicator(data.rwt, null, 0.42)}</td></tr>
                                <tr><td>LV Geometry</td><td><strong>${data.lvGeometry}</strong></td><td>Normal Geometry</td><td>${data.lvGeometry === 'Normal Geometry' ? '‚úÖ Normal' : '‚ö†Ô∏è Abnormal'}</td></tr>
                                <tr><td>Global Longitudinal Strain</td><td>${measurements.gls}</td><td>‚â•18%</td><td>${getStatusIndicator(Math.abs(data.gls), 18, null)}</td></tr>
                            </tbody>
                        </table>

                        <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Left Atrial Assessment</h4>
                        <table>
                            <tbody>
                                <tr><td>LA Area</td><td>${measurements.laArea}</td><td>‚â§20 cm¬≤</td><td>${getStatusIndicator(data.laArea, null, 20)}</td></tr>
                                <tr><td>LA Volume</td><td><strong>${data.laVolume} ml</strong></td><td>Variable</td><td>-</td></tr>
                                <tr><td>LA Volume Index</td><td>${measurements.laVolumeIndex}</td><td>‚â§34 ml/m¬≤</td><td>${statusIndicators.laVolumeIndex}</td></tr>
                                <tr><td>LA Diameter</td><td>${measurements.laDiameter}</td><td>‚â§40 mm</td><td>${getStatusIndicator(data.laDiameter, null, 40)}</td></tr>
                            </tbody>
                        </table>

                        <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Aortic Root & Ascending Aorta</h4>
                        <table>
                            <tbody>
                                <tr><td>Aortic Root</td><td>${measurements.aorticRoot}</td><td>20-37 mm</td><td>${getStatusIndicator(data.aorticRoot, 20, 37)}</td></tr>
                                <tr><td>Ascending Aorta</td><td>${measurements.ascAorta}</td><td>19-35 mm</td><td>${getStatusIndicator(data.ascAorta, 19, 35)}</td></tr>
                                <tr><td>Sinus of Valsalva</td><td><strong>${data.sov} mm</strong></td><td>Variable</td><td>-</td></tr>
                                <tr><td>Sinotubular Junction</td><td><strong>${data.stj} mm</strong></td><td>Variable</td><td>-</td></tr>
                            </tbody>
                        </table>
                    </section>

                    <section class="report-section">
                        <h3><span class="section-icon-report">üíô</span>Right Heart Assessment & Hemodynamics</h3>
                        
                        <div class="measurement-cards">
                            <div class="measurement-card">
                                <div class="measurement-value">${data.tapse}</div>
                                <div class="measurement-label">TAPSE</div>
                                <div class="measurement-range">Normal: ‚â•17 mm</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.pasp}</div>
                                <div class="measurement-label">PASP</div>
                                <div class="measurement-range">Normal: ‚â§40 mmHg</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.cardiacOutput}</div>
                                <div class="measurement-label">Cardiac Output</div>
                                <div class="measurement-range">Normal: 4-8 L/min</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.cardiacIndex}</div>
                                <div class="measurement-label">Cardiac Index</div>
                                <div class="measurement-range">Normal: 2.5-4.0</div>
                            </div>
                        </div>

                        <div class="details-grid">
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Right Ventricular Function</h4>
                                <table>
                                    <tbody>
                                        <tr><td>RV Function</td><td><strong>${data.rvFunction}</strong></td><td>Normal</td><td>${data.rvFunction === 'Normal' ? '‚úÖ Normal' : '‚ö†Ô∏è Abnormal'}</td></tr>
                                        <tr><td>TAPSE</td><td>${measurements.tapse}</td><td>‚â•17 mm</td><td>${statusIndicators.tapse}</td></tr>
                                        <tr><td>RV FAC</td><td><strong>${data.rvFac}%</strong></td><td>‚â•35%</td><td>${getStatusIndicator(data.rvFac, 35, null)}</td></tr>
                                        <tr><td>RV S'</td><td>${measurements.sPrime}</td><td>‚â•9.5 cm/s</td><td>${getStatusIndicator(data.sPrime, 9.5, null)}</td></tr>
                                        <tr><td>RV End-Diastolic Diameter</td><td><strong>${data.rvedd} mm</strong></td><td>19-42 mm</td><td>${getStatusIndicator(data.rvedd, 19, 42)}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Pulmonary Pressures</h4>
                                <table>
                                    <tbody>
                                        <tr><td>RVSP</td><td><strong>${data.rvsp} mmHg</strong></td><td>Variable</td><td>-</td></tr>
                                        <tr><td>RA Pressure</td><td><strong>${data.raPressure} mmHg</strong></td><td>3-8 mmHg</td><td>${getStatusIndicator(data.raPressure, 3, 8)}</td></tr>
                                        <tr><td>PASP</td><td>${measurements.pasp}</td><td>‚â§40 mmHg</td><td>${statusIndicators.pasp}</td></tr>
                                        <tr><td>Pulmonary Hypertension</td><td><span class="severity-badge severity-${data.pht.toLowerCase()}">${data.pht}</span></td><td>None</td><td>${data.pht === 'None' ? '‚úÖ Normal' : '‚ö†Ô∏è Present'}</td></tr>
                                        <tr><td>IVC Diameter</td><td>${measurements.ivc}</td><td>15-25 mm</td><td>${getStatusIndicator(data.ivc, 15, 25)}</td></tr>
                                        <tr><td>IVC Collapsibility</td><td><strong>${data.ivcCollapse}%</strong></td><td>>50%</td><td>${getStatusIndicator(data.ivcCollapse, 50, null)}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <h4 style="margin: 1.5rem 0 1rem 0; color: var(--primary-color);">Hemodynamic Assessment</h4>
                        <table>
                            <tbody>
                                <tr><td>LVOT Diameter</td><td><strong>${data.lvotDiameter} mm</strong></td><td>Variable</td><td>-</td></tr>
                                <tr><td>LVOT VTI</td><td><strong>${data.lvotVti} cm</strong></td><td>Variable</td><td>-</td></tr>
                                <tr><td>Stroke Volume</td><td><strong>${data.strokeVolume} ml</strong></td><td>60-100 ml</td><td>${getStatusIndicator(data.strokeVolume, 60, 100)}</td></tr>
                                <tr><td>Cardiac Output</td><td><strong>${data.cardiacOutput} L/min</strong></td><td>4-8 L/min</td><td>${getStatusIndicator(data.cardiacOutput, 4, 8)}</td></tr>
                                <tr><td>Cardiac Index</td><td>${measurements.cardiacIndex}</td><td>2.5-4.0 L/min/m¬≤</td><td>${statusIndicators.cardiacIndex}</td></tr>
                            </tbody>
                        </table>
                    </section>

                    <section class="report-section">
                        <h3><span class="section-icon-report">üîÑ</span>Diastolic Function Assessment</h3>
                        
                        <div class="measurement-cards">
                            <div class="measurement-card">
                                <div class="measurement-value">${data.eaRatio}</div>
                                <div class="measurement-label">E/A Ratio</div>
                                <div class="measurement-range">Normal: 0.8-2.0</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.eePrime}</div>
                                <div class="measurement-label">E/E' Ratio</div>
                                <div class="measurement-range">Normal: ‚â§14</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.ePrimeAvg}</div>
                                <div class="measurement-label">E' Average</div>
                                <div class="measurement-range">Normal: ‚â•8 cm/s</div>
                            </div>
                            <div class="measurement-card">
                                <div class="measurement-value">${data.diastolicGrade.split(' ')[1] || 'Normal'}</div>
                                <div class="measurement-label">DD Grade</div>
                                <div class="measurement-range">Normal: None</div>
                            </div>
                        </div>

                        <div class="details-grid">
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Mitral Inflow</h4>
                                <table>
                                    <tbody>
                                        <tr><td>E Wave</td><td><strong>${data.eWave} m/s</strong></td><td>Variable</td><td>-</td></tr>
                                        <tr><td>A Wave</td><td><strong>${data.aWave} m/s</strong></td><td>Variable</td><td>-</td></tr>
                                        <tr><td>E/A Ratio</td><td>${measurements.eaRatio}</td><td>0.8-2.0</td><td>${getStatusIndicator(data.eaRatio, 0.8, 2.0)}</td></tr>
                                        <tr><td>Deceleration Time</td><td>${measurements.dt}</td><td>160-240 ms</td><td>${getStatusIndicator(data.dt, 160, 240)}</td></tr>
                                        <tr><td>IVRT</td><td>${measurements.ivrt}</td><td>70-100 ms</td><td>${getStatusIndicator(data.ivrt, 70, 100)}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Tissue Doppler</h4>
                                <table>
                                    <tbody>
                                        <tr><td>E' Septal</td><td>${measurements.ePrime}</td><td>‚â•7 cm/s</td><td>${getStatusIndicator(data.ePrime, 7, null)}</td></tr>
                                        <tr><td>E' Lateral</td><td>${measurements.ePrimeLat}</td><td>‚â•10 cm/s</td><td>${getStatusIndicator(data.ePrimeLat, 10, null)}</td></tr>
                                        <tr><td>E' Average</td><td><strong>${data.ePrimeAvg} cm/s</strong></td><td>‚â•8 cm/s</td><td>${getStatusIndicator(data.ePrimeAvg, 8, null)}</td></tr>
                                        <tr><td>E/E' Ratio</td><td>${measurements.eePrime}</td><td>‚â§14</td><td>${statusIndicators.eePrime}</td></tr>
                                        <tr><td>S/D Ratio</td><td><strong>${data.sdRatio}</strong></td><td>Variable</td><td>-</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Diastolic Function Summary</h4>
                            <p><strong>Grade:</strong> ${data.diastolicGrade}</p>
                            <p><strong>LV Filling Pressures:</strong> ${data.fillingPressures}</p>
                        </div>
                    </section>

                    <section class="report-section">
                        <h3><span class="section-icon-report">ü´Ä</span>Comprehensive Valve Assessment</h3>
                        
                        <div class="details-grid">
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Aortic Valve</h4>
                                <table>
                                    <tbody>
                                        <tr><td>Morphology</td><td><strong>${data.avMorphology}</strong></td><td>Tricuspid</td><td>${data.avMorphology === 'Tricuspid' ? '‚úÖ Normal' : '‚ö†Ô∏è Abnormal'}</td></tr>
                                        <tr><td>Valve Area</td><td>${measurements.avArea}</td><td>>2.0 cm¬≤</td><td>${getStatusIndicator(data.avArea, 2.0, null)}</td></tr>
                                        <tr><td>Peak Velocity</td><td><strong>${data.avMaxVel} m/s</strong></td><td><2.5 m/s</td><td>${getStatusIndicator(data.avMaxVel, null, 2.5)}</td></tr>
                                        <tr><td>Mean Gradient</td><td><strong>${data.avMeanGrad} mmHg</strong></td><td><20 mmHg</td><td>${getStatusIndicator(data.avMeanGrad, null, 20)}</td></tr>
                                        <tr><td>AS Severity</td><td>${getSeverityBadge(data.avStenosis)}</td><td>None</td><td>${data.avStenosis === 'None' ? '‚úÖ Normal' : '‚ö†Ô∏è Present'}</td></tr>
                                        <tr><td>AR Severity</td><td>${getSeverityBadge(data.arSeverity)}</td><td>None/Trace</td><td>${['None', 'Trace'].includes(data.arSeverity) ? '‚úÖ Normal' : '‚ö†Ô∏è Significant'}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Mitral Valve</h4>
                                <table>
                                    <tbody>
                                        <tr><td>Morphology</td><td><strong>${data.mvMorphology}</strong></td><td>Normal</td><td>${data.mvMorphology === 'Normal' ? '‚úÖ Normal' : '‚ö†Ô∏è Abnormal'}</td></tr>
                                        <tr><td>Valve Area</td><td>${measurements.mvArea}</td><td>>2.5 cm¬≤</td><td>${getStatusIndicator(data.mvArea, 2.5, null)}</td></tr>
                                        <tr><td>Mean Gradient</td><td><strong>${data.mvMeanGrad} mmHg</strong></td><td><5 mmHg</td><td>${getStatusIndicator(data.mvMeanGrad, null, 5)}</td></tr>
                                        <tr><td>MS Severity</td><td>${getSeverityBadge(data.mvStenosis)}</td><td>None</td><td>${data.mvStenosis === 'None' ? '‚úÖ Normal' : '‚ö†Ô∏è Present'}</td></tr>
                                        <tr><td>MR Severity</td><td>${getSeverityBadge(data.mrSeverity)}</td><td>None/Trace</td><td>${['None', 'Trace'].includes(data.mrSeverity) ? '‚úÖ Normal' : '‚ö†Ô∏è Significant'}</td></tr>
                                        <tr><td>MR Mechanism</td><td><strong>${data.mrMechanism}</strong></td><td>None</td><td>${data.mrMechanism === 'None' ? '‚úÖ Normal' : '‚ÑπÔ∏è Present'}</td></tr>
                                        ${data.wilkinsTotal > 0 ? `<tr><td>Wilkins Score</td><td><strong>${data.wilkinsTotal}/16</strong></td><td><8</td><td>${getStatusIndicator(data.wilkinsTotal, null, 8)}</td></tr>` : ''}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="details-grid">
                            <div>
                                <h4 style="margin: 1rem 0 1rem 0; color: var(--primary-color);">Tricuspid Valve</h4>
                                <table>
                                    <tbody>
                                        <tr><td>Morphology</td><td><strong>${data.tvMorphology}</strong></td><td>Normal</td><td>${data.tvMorphology === 'Normal' ? '‚úÖ Normal' : '‚ö†Ô∏è Abnormal'}</td></tr>
                                        <tr><td>Peak Velocity</td><td><strong>${data.tvMaxVel} m/s</strong></td><td><2.8 m/s</td><td>${getStatusIndicator(data.tvMaxVel, null, 2.8)}</td></tr>
                                        <tr><td>Peak Gradient</td><td><strong>${data.tvMaxGrad} mmHg</strong></td><td><30 mmHg</td><td>${getStatusIndicator(data.tvMaxGrad, null, 30)}</td></tr>
                                        <tr><td>TR Severity</td><td>${getSeverityBadge(data.trSeverity)}</td><td>None/Trace</td><td>${['None', 'Trace'].includes(data.trSeverity) ? '‚úÖ Normal' : '‚ö†Ô∏è Significant'}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <h4 style="margin: 1rem 0 1rem 0; color: var(--primary-color);">Pulmonary Valve</h4>
                                <table>
                                    <tbody>
                                        <tr><td>Morphology</td><td><strong>${data.pvMorphology}</strong></td><td>Normal</td><td>${data.pvMorphology === 'Normal' ? '‚úÖ Normal' : '‚ö†Ô∏è Abnormal'}</td></tr>
                                        <tr><td>Peak Velocity</td><td><strong>${data.pvMaxVel} m/s</strong></td><td><1.5 m/s</td><td>${getStatusIndicator(data.pvMaxVel, null, 1.5)}</td></tr>
                                        <tr><td>PS Severity</td><td>${getSeverityBadge(data.psSeverity)}</td><td>None</td><td>${data.psSeverity === 'None' ? '‚úÖ Normal' : '‚ö†Ô∏è Present'}</td></tr>
                                        <tr><td>PR Severity</td><td>${getSeverityBadge(data.prSeverity)}</td><td>None/Trace</td><td>${['None', 'Trace'].includes(data.prSeverity) ? '‚úÖ Normal' : '‚ö†Ô∏è Significant'}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        ${data.prostheticAV !== 'None' || data.prostheticMV !== 'None' ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Prosthetic Valves</h4>
                            ${data.prostheticAV !== 'None' ? `<p><strong>Aortic:</strong> ${data.prostheticAV} prosthetic valve</p>` : ''}
                            ${data.prostheticMV !== 'None' ? `<p><strong>Mitral:</strong> ${data.prostheticMV} prosthetic valve</p>` : ''}
                            <p><strong>Function:</strong> ${data.prostheticFunction}</p>
                        </div>
                        ` : ''}
                    </section>

                    ${data.wallMotionFindings ? `
                    <section class="report-section">
                        <h3><span class="section-icon-report">üß±</span>Regional Wall Motion Analysis</h3>
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                            <p><strong>Wall Motion Score Index:</strong> ${measurements.wmsi}</p>
                            <p><strong>Abnormal Segments:</strong> ${data.wallMotionFindings}</p>
                            ${data.coronaryTerritory !== 'None' ? `<p><strong>Suspected Territory:</strong> ${data.coronaryTerritory}</p>` : ''}
                        </div>
                    </section>
                    ` : ''}

                    ${data.pericardialEffusion !== 'None' || data.laThrombus !== 'None' || data.vegetation !== 'None' || data.congenitalAbnormalities !== 'None' ? `
                    <section class="report-section">
                        <h3><span class="section-icon-report">üîç</span>Additional Findings</h3>
                        <div class="details-grid">
                            ${data.pericardialEffusion !== 'None' || data.tamponade !== 'No' ? `
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Pericardium</h4>
                                <table>
                                    <tbody>
                                        ${data.pericardialEffusion !== 'None' ? `<tr><td>Effusion</td><td>${getSeverityBadge(data.pericardialEffusion)}</td></tr>` : ''}
                                        ${data.tamponade !== 'No' ? `<tr><td>Tamponade</td><td><span class="severity-badge severity-severe">${data.tamponade}</span></td></tr>` : ''}
                                        ${data.pericardialThickening === 'Yes' ? `<tr><td>Thickening</td><td><span class="severity-badge severity-moderate">Present</span></td></tr>` : ''}
                                    </tbody>
                                </table>
                            </div>
                            ` : ''}
                            
                            ${data.laThrombus !== 'None' || data.lvThrombus !== 'None' || data.vegetation !== 'None' ? `
                            <div>
                                <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Masses & Thrombi</h4>
                                <table>
                                    <tbody>
                                        ${data.laThrombus !== 'None' ? `<tr><td>LA Thrombus/SEC</td><td><span class="severity-badge severity-moderate">${data.laThrombus}</span></td></tr>` : ''}
                                        ${data.lvThrombus !== 'None' ? `<tr><td>LV Thrombus</td><td><span class="severity-badge severity-severe">${data.lvThrombus}</span></td></tr>` : ''}
                                        ${data.vegetation !== 'None' ? `<tr><td>Vegetation</td><td><span class="severity-badge severity-severe">${data.vegetation}</span></td></tr>` : ''}
                                        ${data.vegetationLocation !== 'None' ? `<tr><td>Location</td><td><strong>${data.vegetationLocation}</strong></td></tr>` : ''}
                                    </tbody>
                                </table>
                            </div>
                            ` : ''}
                        </div>
                        
                        ${data.congenitalAbnormalities !== 'None' ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Congenital Abnormalities</h4>
                            <p>${data.congenitalAbnormalities}</p>
                        </div>
                        ` : ''}
                    </section>
                    ` : ''}

                    <section class="report-section">
                        <h3><span class="section-icon-report">üî¨</span>Clinical Interpretation & Conclusions</h3>
                        <ul class="findings-list">
                            ${conclusionItems || '<li>Comprehensive echocardiographic study within normal limits.</li>'}
                        </ul>
                        
                        ${data.clinicalCorrelation !== 'None' && data.clinicalCorrelation.trim() !== '' ? `
                        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 0.5rem; border-left: 4px solid var(--primary-color);">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Clinical Recommendations</h4>
                            <p>${data.clinicalCorrelation}</p>
                        </div>
                        ` : ''}
                    </section>

                    <footer class="report-footer">
                        <div>
                            <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Technical Information</h4>
                            <p><strong>Study Quality:</strong> ${data.studyQuality}</p>
                            <p><strong>Report Generated:</strong> ${new Date().toLocaleString('en-GB')}</p>
                            <p><strong>Report ID:</strong> ECH-${data.patientId}-${new Date().getFullYear()}</p>
                            <p><strong>Urgency:</strong> <span class="severity-badge severity-${data.reportUrgency.toLowerCase()}">${data.reportUrgency}</span></p>
                        </div>
                        
                        <div class="signature-section">
                            <div class="signature-line"></div>
                            <div class="physician-name">${data.performingPhysician}</div>
                            <div class="physician-title">Consultant Cardiologist</div>
                            <div class="physician-title">Board Certified in Echocardiography</div>
                            <div class="report-meta">
                                Digital signature verified<br>
                                ${new Date().toLocaleDateString('en-GB')}
                            </div>
                        </div>
                        
                        <div class="disclaimer">
                            <strong>Important Clinical Disclaimer:</strong> This comprehensive echocardiographic assessment should be interpreted in conjunction with clinical history, physical examination, and other diagnostic studies. Reference ranges may vary based on age, gender, body surface area, and ethnicity. All measurements performed according to current ASE/EACVI guidelines. This report has been generated using advanced AI-assisted analysis and reviewed by qualified medical personnel. For urgent clinical concerns, please contact the performing physician directly.
                        </div>
                    </footer>
                </div>
            `;

            document.getElementById('report-output').innerHTML = reportHTML;
            showNotification('Professional report generated successfully!', 'success');
        }

        // Initialize the application
        window.onload = function() {
            // Set current date
            document.getElementById('examDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('examTime').value = new Date().toTimeString().slice(0, 5);
            
            // Calculate initial values
            calculateBSA();
            calculateLVMass();
            calculateFS();
            calculateDiastolic();
            calculateHemodynamics();
            calculatePASP();
            calculateRAPressure();
            calculateWilkinsScore();
            calculateWMSI();
            
            // Add event listeners for real-time calculations
            const calculationInputs = [
                'height', 'weight', 'lvidd', 'lvids', 'ivsd', 'lvpwd', 'laVolume', 'raVolume',
                'rvsp', 'ivc', 'ivcCollapse', 'eWave', 'aWave', 'ePrime', 'ePrimeLat', 'sPulm', 'dPulm',
                'lvotDiameter', 'lvotVti', 'hr', 'avMaxVel', 'tvMaxVel',
                'wilkinsMobility', 'wilkinsThickness', 'wilkinsCalc', 'wilkinsSubval'
            ];
            
            calculationInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => {
                        calculateBSA();
                        calculateLVMass();
                        calculateFS();
                        calculateLAVolumeIndex();
                        calculateRAPressure();
                        calculatePASP();
                        calculateDiastolic();
                        calculateHemodynamics();
                        calculateAVGradients();
                        calculateTVGradient();
                        calculateWilkinsScore();
                        calculateWMSI();
                    });
                }
            });
            
            // Generate initial report
            generateReport();
            
            showNotification('CardioVision Pro initialized successfully!', 'success');
        };
    </script>
</body>
</html>